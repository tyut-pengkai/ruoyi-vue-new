<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.sale.mapper.SysSaleOrderItemCardMapper">

    <resultMap type="SysSaleOrderItemCard" id="SysSaleOrderItemCardResult">
        <result property="id" column="id"/>
        <result property="itemId" column="item_id"/>
        <result property="cardId" column="card_id"/>
    </resultMap>

    <resultMap id="SysSaleOrderItemCardSysCardResult" type="SysSaleOrderItemCard" extends="SysSaleOrderItemCardResult">
        <collection property="sysCardList" notNullColumn="sub_card_id" javaType="java.util.List"
                    resultMap="SysCardResult"/>
    </resultMap>

    <resultMap type="SysCard" id="SysCardResult">
        <result property="cardId" column="sub_card_id"/>
        <result property="appId" column="sub_app_id"/>
        <result property="cardName" column="sub_card_name"/>
        <result property="cardNo" column="sub_card_no"/>
        <result property="cardPass" column="sub_card_pass"/>
        <result property="quota" column="sub_quota"/>
        <result property="price" column="sub_price"/>
        <result property="expireTime" column="sub_expire_time"/>
        <result property="isSold" column="sub_is_sold"/>
        <result property="onSale" column="sub_on_sale"/>
        <result property="isCharged" column="sub_is_charged"/>
        <result property="templateId" column="sub_template_id"/>
        <result property="status" column="sub_status"/>
        <result property="chargeRule" column="sub_charge_rule"/>
        <result property="createBy" column="sub_create_by"/>
        <result property="createTime" column="sub_create_time"/>
        <result property="updateBy" column="sub_update_by"/>
        <result property="updateTime" column="sub_update_time"/>
        <result property="remark" column="sub_remark"/>
    </resultMap>

    <sql id="selectSysSaleOrderItemCardVo">
        select id, item_id, card_id
        from sys_sale_order_item_card
    </sql>

    <select id="selectSysSaleOrderItemCardList" parameterType="SysSaleOrderItemCard"
            resultMap="SysSaleOrderItemCardResult">
        <include refid="selectSysSaleOrderItemCardVo"/>
        <where>
            <if test="itemId != null ">and item_id = #{itemId}</if>
            <if test="cardId != null ">and card_id = #{cardId}</if>
        </where>
    </select>

    <select id="selectSysSaleOrderItemCardById" parameterType="Long" resultMap="SysSaleOrderItemCardSysCardResult">
        select a.id,
               a.item_id,
               a.card_id,
               b.card_id     as sub_card_id,
               b.app_id      as sub_app_id,
               b.card_name   as sub_card_name,
               b.card_no     as sub_card_no,
               b.card_pass   as sub_card_pass,
               b.quota       as sub_quota,
               b.price       as sub_price,
               b.expire_time as sub_expire_time,
               b.is_sold     as sub_is_sold,
               b.on_sale     as sub_on_sale,
               b.is_charged  as sub_is_charged,
               b.template_id as sub_template_id,
               b.status      as sub_status,
               b.charge_rule as sub_charge_rule,
               b.create_by   as sub_create_by,
               b.create_time as sub_create_time,
               b.update_by   as sub_update_by,
               b.update_time as sub_update_time,
               b.remark      as sub_remark
        from sys_sale_order_item_card a
                 left join sys_card b on b.card_id = a.id
        where a.id = #{id}
    </select>

    <insert id="insertSysSaleOrderItemCard" parameterType="SysSaleOrderItemCard" useGeneratedKeys="true"
            keyProperty="id">
        insert into sys_sale_order_item_card
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="itemId != null">item_id,</if>
            <if test="cardId != null">card_id,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="itemId != null">#{itemId},</if>
            <if test="cardId != null">#{cardId},</if>
        </trim>
    </insert>

    <update id="updateSysSaleOrderItemCard" parameterType="SysSaleOrderItemCard">
        update sys_sale_order_item_card
        <trim prefix="SET" suffixOverrides=",">
            <if test="itemId != null">item_id = #{itemId},</if>
            <if test="cardId != null">card_id = #{cardId},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteSysSaleOrderItemCardById" parameterType="Long">
        delete
        from sys_sale_order_item_card
        where id = #{id}
    </delete>

    <delete id="deleteSysSaleOrderItemCardByIds" parameterType="String">
        delete from sys_sale_order_item_card where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <delete id="deleteSysCardByCardIds" parameterType="String">
        delete from sys_card where card_id in
        <foreach item="cardId" collection="array" open="(" separator="," close=")">
            #{cardId}
        </foreach>
    </delete>

    <delete id="deleteSysCardByCardId" parameterType="Long">
        delete
        from sys_card
        where card_id = #{cardId}
    </delete>

    <insert id="batchSysCard">
        insert into sys_card( card_id, app_id, card_name, card_no, card_pass, quota, price, expire_time, is_sold,
        on_sale, is_charged, template_id, status, charge_rule, create_by, create_time, update_by, update_time, remark)
        values
        <foreach item="item" index="index" collection="list" separator=",">
            ( #{item.cardId}, #{item.appId}, #{item.cardName}, #{item.cardNo}, #{item.cardPass}, #{item.quota},
            #{item.price}, #{item.expireTime}, #{item.isSold}, #{item.onSale}, #{item.isCharged}, #{item.templateId},
            #{item.status}, #{item.chargeRule}, #{item.createBy}, #{item.createTime}, #{item.updateBy},
            #{item.updateTime}, #{item.remark})
        </foreach>
    </insert>
</mapper>