const e=new WeakMap;function t(t,i){return e.get(t)&&e.get(t).get(i)}function i(e,i,n){if(void 0===i)throw new TypeError;const r=t(i,n);return r&&r.get(e)}function n(i,n,r,o){if(o&&!["string","symbol"].includes(typeof o))throw new TypeError;(t(r,o)||function(t,i){const n=e.get(t)||new Map;e.set(t,n);const r=n.get(i)||new Map;return n.set(i,r),r}(r,o)).set(i,n)}function r(e,t,n){return i(e,t,n)?i(e,t,n):Object.getPrototypeOf(t)?r(e,Object.getPrototypeOf(t),n):void 0}const o={decorate:function(e,t,i,n){if(!Array.isArray(e)||0===e.length)throw new TypeError;return void 0!==i?function(e,t,i,n){return e.reverse().forEach((e=>{n=e(t,i,n)||n})),n}(e,t,i,n):"function"==typeof t?function(e,t){return e.reverse().forEach((e=>{const i=e(t);i&&(t=i)})),t}(e,t):void 0},defineMetadata:function(e,t,i,r){n(e,t,i,r)},getMetadata:function(e,t,i){return r(e,t,i)},getOwnMetadata:function(e,t,n){return i(e,t,n)},hasMetadata:function(e,t,i){return!!r(e,t,i)},hasOwnMetadata:function(e,t,n){return!!i(e,t,n)},metadata:function(e,t){return function(i,r){n(e,t,i,r)}}};var s;Object.assign(Reflect,o),function(e){e[e.Transient=0]="Transient",e[e.Singleton=1]="Singleton",e[e.ResolutionScoped=2]="ResolutionScoped",e[e.ContainerScoped=3]="ContainerScoped"}(s||(s={}));var a=s,c=function(e,t){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},c(e,t)};function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function u(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s}function p(e,t){return function(i,n){t(i,n,e)}}function d(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function f(e,t,i,n){return new(i||(i=Promise))((function(r,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function h(e,t){var i,n,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function v(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,o=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}function y(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}"function"==typeof SuppressedError&&SuppressedError;var m="injectionTokens";function w(e){return!!e.useClass}function _(e){return!!e.useFactory}var b=function(){function e(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return e.prototype.createProxy=function(e){var t,i=this,n=!1;return new Proxy({},this.createHandler((function(){return n||(t=e(i.wrap()),n=!0),t})))},e.prototype.createHandler=function(e){var t={};return this.reflectMethods.forEach((function(i){t[i]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t[0]=e(),Reflect[i].apply(void 0,y(t))}})),t},e}();function S(e){return"string"==typeof e||"symbol"==typeof e}function O(e){return"object"==typeof e&&"token"in e&&"transform"in e}function E(e){return!!e.useToken}function I(e){return null!=e.useValue}var R=function(){function e(){this._registryMap=new Map}return e.prototype.entries=function(){return this._registryMap.entries()},e.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},e.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},e.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},e.prototype.setAll=function(e,t){this._registryMap.set(e,t)},e.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},e.prototype.clear=function(){this._registryMap.clear()},e.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},e}(),T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t}(R),C=function(){this.scopedResolutions=new Map};function P(e,t,i){var n,r,o=g(e.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1],s=function(e,t){return null===e?"at position #"+t:'"'+e.split(",")[t].trim()+'" at position #'+t}(void 0===o?null:o,t);return n="Cannot inject the dependency "+s+' of "'+e.name+'" constructor. Reason:',void 0===r&&(r="    "),y([n],i.message.split("\n").map((function(e){return r+e}))).join("\n")}var A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t}(R),L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t}(R),x=function(){this.preResolution=new A,this.postResolution=new L},D=new Map,F=function(){function e(e){this.parent=e,this._registry=new T,this.interceptors=new x,this.disposed=!1,this.disposables=new Set}return e.prototype.register=function(e,t,i){var n;if(void 0===i&&(i={lifecycle:a.Transient}),this.ensureNotDisposed(),n=function(e){return w(e)||I(e)||E(e)||_(e)}(t)?t:{useClass:t},E(n))for(var r=[e],o=n;null!=o;){var s=o.useToken;if(r.includes(s))throw new Error("Token registration cycle detected! "+y(r,[s]).join(" -> "));r.push(s);var c=this._registry.get(s);o=c&&E(c.provider)?c.provider:null}if((i.lifecycle===a.Singleton||i.lifecycle==a.ContainerScoped||i.lifecycle==a.ResolutionScoped)&&(I(n)||_(n)))throw new Error('Cannot use lifecycle "'+a[i.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:n,options:i}),this},e.prototype.registerType=function(e,t){return this.ensureNotDisposed(),S(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},e.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},e.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),S(e)){if(S(t))return this.register(e,{useToken:t},{lifecycle:a.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:a.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var i=e;return t&&!S(t)&&(i=t),this.register(e,{useClass:i},{lifecycle:a.Singleton})},e.prototype.resolve=function(e,t,i){void 0===t&&(t=new C),void 0===i&&(i=!1),this.ensureNotDisposed();var n=this.getRegistration(e);if(!n&&S(e)){if(i)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),n){var r=this.resolveRegistration(n,t);return this.executePostResolutionInterceptor(e,r,"Single"),r}if(function(e){return"function"==typeof e||e instanceof b}(e)){r=this.construct(e,t);return this.executePostResolutionInterceptor(e,r,"Single"),r}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},e.prototype.executePreResolutionInterceptor=function(e,t){var i,n;if(this.interceptors.preResolution.has(e)){var r=[];try{for(var o=v(this.interceptors.preResolution.getAll(e)),s=o.next();!s.done;s=o.next()){var a=s.value;"Once"!=a.options.frequency&&r.push(a),a.callback(e,t)}}catch(e){i={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}this.interceptors.preResolution.setAll(e,r)}},e.prototype.executePostResolutionInterceptor=function(e,t,i){var n,r;if(this.interceptors.postResolution.has(e)){var o=[];try{for(var s=v(this.interceptors.postResolution.getAll(e)),a=s.next();!a.done;a=s.next()){var c=a.value;"Once"!=c.options.frequency&&o.push(c),c.callback(e,t,i)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}this.interceptors.postResolution.setAll(e,o)}},e.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===a.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var i,n=e.options.lifecycle===a.Singleton,r=e.options.lifecycle===a.ContainerScoped,o=n||r;return i=I(e.provider)?e.provider.useValue:E(e.provider)?o?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):w(e.provider)?o?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):_(e.provider)?e.provider.useFactory(this):this.construct(e.provider,t),e.options.lifecycle===a.ResolutionScoped&&t.scopedResolutions.set(e,i),i},e.prototype.resolveAll=function(e,t,i){var n=this;void 0===t&&(t=new C),void 0===i&&(i=!1),this.ensureNotDisposed();var r=this.getAllRegistrations(e);if(!r&&S(e)){if(i)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),r){var o=r.map((function(e){return n.resolveRegistration(e,t)}));return this.executePostResolutionInterceptor(e,o,"All"),o}var s=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,s,"All"),s},e.prototype.isRegistered=function(e,t){return void 0===t&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},e.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},e.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var i=v(this._registry.entries()),n=i.next();!n.done;n=i.next()){var r=g(n.value,2),o=r[0],s=r[1];this._registry.setAll(o,s.filter((function(e){return!I(e.provider)})).map((function(e){return e.instance=void 0,e})))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.createChildContainer=function(){var t,i;this.ensureNotDisposed();var n=new e(this);try{for(var r=v(this._registry.entries()),o=r.next();!o.done;o=r.next()){var s=g(o.value,2),c=s[0],l=s[1];l.some((function(e){return e.options.lifecycle===a.ContainerScoped}))&&n._registry.setAll(c,l.map((function(e){return e.options.lifecycle===a.ContainerScoped?{provider:e.provider,options:e.options}:e})))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return n},e.prototype.beforeResolution=function(e,t,i){void 0===i&&(i={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:i})},e.prototype.afterResolution=function(e,t,i){void 0===i&&(i={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:i})},e.prototype.dispose=function(){return f(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach((function(t){var i=t.dispose();i&&e.push(i)})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},e.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},e.prototype.construct=function(e,t){var i=this;if(e instanceof b)return e.createProxy((function(e){return i.resolve(e,t)}));var n,r=function(){var n=D.get(e);if(!n||0===n.length){if(0===e.length)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var r=n.map(i.resolveParams(t,e));return new(e.bind.apply(e,y([void 0],r)))}();return"function"!=typeof(n=r).dispose||n.dispose.length>0||this.disposables.add(r),r},e.prototype.resolveParams=function(e,t){var i=this;return function(n,r){var o,s,a,c;try{return"object"==typeof(c=n)&&"token"in c&&"multiple"in c?O(n)?n.multiple?(o=i.resolve(n.transform)).transform.apply(o,y([i.resolveAll(n.token,new C,n.isOptional)],n.transformArgs)):(s=i.resolve(n.transform)).transform.apply(s,y([i.resolve(n.token,e,n.isOptional)],n.transformArgs)):n.multiple?i.resolveAll(n.token,new C,n.isOptional):i.resolve(n.token,e,n.isOptional):O(n)?(a=i.resolve(n.transform,e)).transform.apply(a,y([i.resolve(n.token,e)],n.transformArgs)):i.resolve(n,e)}catch(e){throw new Error(P(t,r,e))}}},e.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},e}(),j=new F;function k(e,t){return function(e,t){return function(t,i,n){var r=Reflect.getOwnMetadata(m,t)||{};r[n]=e,Reflect.defineMetadata(m,r,t)}}({token:e,multiple:!1,isOptional:t&&t.isOptional})}function N(e){return function(e){D.set(e,function(e){var t=Reflect.getMetadata("design:paramtypes",e)||[],i=Reflect.getOwnMetadata(m,e)||{};return Object.keys(i).forEach((function(e){t[+e]=i[e]})),t}(e))}}function W(e,t){return function(t){N()(t),j.register(t,t,{lifecycle:e})}}if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");const M=Symbol("IContainer");function $(...e){return k(...e)}function U(){return W(a.ContainerScoped)}function K(){return W(a.ContainerScoped)}const V="weboffice.qq.com",H="Request timeout: ",B="TDWebOffice",q="D0000000000000001",X="_o_tcv",z="_o_tck",G=Symbol("null");function Q(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Y,J,Z={exports:{}},ee={exports:{}};Y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",J={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&J.rotl(e,8)|4278255360&J.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=J.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],i=0,n=0;i<e.length;i++,n+=8)t[n>>>5]|=e[i]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],i=0;i<32*e.length;i+=8)t.push(e[i>>>5]>>>24-i%32&255);return t},bytesToHex:function(e){for(var t=[],i=0;i<e.length;i++)t.push((e[i]>>>4).toString(16)),t.push((15&e[i]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],i=0;i<e.length;i+=2)t.push(parseInt(e.substr(i,2),16));return t},bytesToBase64:function(e){for(var t=[],i=0;i<e.length;i+=3)for(var n=e[i]<<16|e[i+1]<<8|e[i+2],r=0;r<4;r++)8*i+6*r<=8*e.length?t.push(Y.charAt(n>>>6*(3-r)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],i=0,n=0;i<e.length;n=++i%4)0!=n&&t.push((Y.indexOf(e.charAt(i-1))&Math.pow(2,-2*n+8)-1)<<2*n|Y.indexOf(e.charAt(i))>>>6-2*n);return t}},ee.exports=J;var te=ee.exports,ie={utf8:{stringToBytes:function(e){return ie.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(ie.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],i=0;i<e.length;i++)t.push(255&e.charCodeAt(i));return t},bytesToString:function(e){for(var t=[],i=0;i<e.length;i++)t.push(String.fromCharCode(e[i]));return t.join("")}}},ne=ie,re=function(e){return null!=e&&(oe(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&oe(e.slice(0,0))}(e)||!!e._isBuffer)};function oe(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}!function(){var e=te,t=ne.utf8,i=re,n=ne.bin,r=function(o,s){o.constructor==String?o=s&&"binary"===s.encoding?n.stringToBytes(o):t.stringToBytes(o):i(o)?o=Array.prototype.slice.call(o,0):Array.isArray(o)||o.constructor===Uint8Array||(o=o.toString());for(var a=e.bytesToWords(o),c=8*o.length,l=1732584193,u=-271733879,p=-1732584194,d=271733878,f=0;f<a.length;f++)a[f]=16711935&(a[f]<<8|a[f]>>>24)|4278255360&(a[f]<<24|a[f]>>>8);a[c>>>5]|=128<<c%32,a[14+(c+64>>>9<<4)]=c;var h=r._ff,v=r._gg,g=r._hh,y=r._ii;for(f=0;f<a.length;f+=16){var m=l,w=u,_=p,b=d;l=h(l,u,p,d,a[f+0],7,-680876936),d=h(d,l,u,p,a[f+1],12,-389564586),p=h(p,d,l,u,a[f+2],17,606105819),u=h(u,p,d,l,a[f+3],22,-1044525330),l=h(l,u,p,d,a[f+4],7,-176418897),d=h(d,l,u,p,a[f+5],12,1200080426),p=h(p,d,l,u,a[f+6],17,-1473231341),u=h(u,p,d,l,a[f+7],22,-45705983),l=h(l,u,p,d,a[f+8],7,1770035416),d=h(d,l,u,p,a[f+9],12,-1958414417),p=h(p,d,l,u,a[f+10],17,-42063),u=h(u,p,d,l,a[f+11],22,-1990404162),l=h(l,u,p,d,a[f+12],7,1804603682),d=h(d,l,u,p,a[f+13],12,-40341101),p=h(p,d,l,u,a[f+14],17,-1502002290),l=v(l,u=h(u,p,d,l,a[f+15],22,1236535329),p,d,a[f+1],5,-165796510),d=v(d,l,u,p,a[f+6],9,-1069501632),p=v(p,d,l,u,a[f+11],14,643717713),u=v(u,p,d,l,a[f+0],20,-373897302),l=v(l,u,p,d,a[f+5],5,-701558691),d=v(d,l,u,p,a[f+10],9,38016083),p=v(p,d,l,u,a[f+15],14,-660478335),u=v(u,p,d,l,a[f+4],20,-405537848),l=v(l,u,p,d,a[f+9],5,568446438),d=v(d,l,u,p,a[f+14],9,-1019803690),p=v(p,d,l,u,a[f+3],14,-187363961),u=v(u,p,d,l,a[f+8],20,1163531501),l=v(l,u,p,d,a[f+13],5,-1444681467),d=v(d,l,u,p,a[f+2],9,-51403784),p=v(p,d,l,u,a[f+7],14,1735328473),l=g(l,u=v(u,p,d,l,a[f+12],20,-1926607734),p,d,a[f+5],4,-378558),d=g(d,l,u,p,a[f+8],11,-2022574463),p=g(p,d,l,u,a[f+11],16,1839030562),u=g(u,p,d,l,a[f+14],23,-35309556),l=g(l,u,p,d,a[f+1],4,-1530992060),d=g(d,l,u,p,a[f+4],11,1272893353),p=g(p,d,l,u,a[f+7],16,-155497632),u=g(u,p,d,l,a[f+10],23,-1094730640),l=g(l,u,p,d,a[f+13],4,681279174),d=g(d,l,u,p,a[f+0],11,-358537222),p=g(p,d,l,u,a[f+3],16,-722521979),u=g(u,p,d,l,a[f+6],23,76029189),l=g(l,u,p,d,a[f+9],4,-640364487),d=g(d,l,u,p,a[f+12],11,-421815835),p=g(p,d,l,u,a[f+15],16,530742520),l=y(l,u=g(u,p,d,l,a[f+2],23,-995338651),p,d,a[f+0],6,-198630844),d=y(d,l,u,p,a[f+7],10,1126891415),p=y(p,d,l,u,a[f+14],15,-1416354905),u=y(u,p,d,l,a[f+5],21,-57434055),l=y(l,u,p,d,a[f+12],6,1700485571),d=y(d,l,u,p,a[f+3],10,-1894986606),p=y(p,d,l,u,a[f+10],15,-1051523),u=y(u,p,d,l,a[f+1],21,-2054922799),l=y(l,u,p,d,a[f+8],6,1873313359),d=y(d,l,u,p,a[f+15],10,-30611744),p=y(p,d,l,u,a[f+6],15,-1560198380),u=y(u,p,d,l,a[f+13],21,1309151649),l=y(l,u,p,d,a[f+4],6,-145523070),d=y(d,l,u,p,a[f+11],10,-1120210379),p=y(p,d,l,u,a[f+2],15,718787259),u=y(u,p,d,l,a[f+9],21,-343485551),l=l+m>>>0,u=u+w>>>0,p=p+_>>>0,d=d+b>>>0}return e.endian([l,u,p,d])};r._ff=function(e,t,i,n,r,o,s){var a=e+(t&i|~t&n)+(r>>>0)+s;return(a<<o|a>>>32-o)+t},r._gg=function(e,t,i,n,r,o,s){var a=e+(t&n|i&~n)+(r>>>0)+s;return(a<<o|a>>>32-o)+t},r._hh=function(e,t,i,n,r,o,s){var a=e+(t^i^n)+(r>>>0)+s;return(a<<o|a>>>32-o)+t},r._ii=function(e,t,i,n,r,o,s){var a=e+(i^(t|~n))+(r>>>0)+s;return(a<<o|a>>>32-o)+t},r._blocksize=16,r._digestsize=16,Z.exports=function(t,i){if(null==t)throw new Error("Illegal argument "+t);var o=e.wordsToBytes(r(t,i));return i&&i.asBytes?o:i&&i.asString?n.bytesToString(o):e.bytesToHex(o)}}();var se=Q(Z.exports);const ae=e=>"number"==typeof e,ce=e=>"string"==typeof e,le=e=>!!e&&"object"==typeof e,ue=e=>!!e&&"object"==typeof e,pe=()=>Math.random().toString(36).substring(2,16),de=e=>new Promise((t=>{e instanceof Promise?e.then((e=>t([e,null]))).catch((e=>t([null,e]))):t([e,null])})),fe=(e=100)=>new Promise((t=>setTimeout(t,e)));const he=e=>{var t;let i=document.body;var n;return ce(e)?i=null!==(t=document.getElementById(e))&&void 0!==t?t:document.body:"object"==typeof(n=e)&&n instanceof HTMLElement&&(i=e),i},ve=(e=V)=>/^[a-z][\d+.a-z-]*:\/\//i.test(e)?e:`${location.protocol}//${e}`,ge=(e=V)=>!e.includes(V),ye=(e,t=location.href)=>new URL(t).searchParams.get(e),me=e=>{var t;return null===(t=/.*\/(\w+)\/\w+\??/.exec(e))||void 0===t?void 0:t.pop()};function we(e){const t=new Set,i="Circular";try{return JSON.stringify(e,((e,n)=>{if(le(n)||Array.isArray(n)){if(t.has(n))return`["${i}"]`;t.add(n)}return n}))}catch(t){return Array.isArray(e)?`["${i}"]`:le(e)?`{"Object":["${i}"]}`:i}}function _e(e=Date.now()){const t=new Date(e);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}function be(e){return le(e)?window.btoa(Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&")):null}class Se{constructor(){this._isOpen=!1,this._promise=new Promise((e=>{this._completePromise=e}))}isOpen(){return this._isOpen}open(){this._isOpen=!0,this._completePromise(!0)}wait(){return this._promise}}function Oe(e){const{srcParams:t}=e,i=new URLSearchParams(t),n=be(e.customParams),r=be(e.customHeaders),o=Object.assign(Object.assign({},n&&{wo_custom_params:n}),r&&{wo_custom_headers:r});for(const[e,t]of Object.entries(o))i.set(e,t);return i.toString()}var Ee;!function(e){e.LOG="log",e.INFO="info",e.WARN="warn",e.ERROR="error"}(Ee||(Ee={}));const Ie={log:"#007a41",info:"#1e6fff",warn:"#e07800",error:"#e02424",fatal:"#e02424",logType:"rgba(69, 77, 90, 0.6)"},Re=e=>`display:inline-block;background-color:${Ie[e]};color:#fff;padding:2px 4px;`;const Te=new class{constructor(e,t=console){this.name=e,this.logger=t}setLogger(e){this.logger=e}log(...e){this.doLog(Ee.INFO,...e)}info(...e){this.doLog(Ee.INFO,...e)}warn(...e){this.doLog(Ee.WARN,...e)}error(...e){this.doLog(Ee.ERROR,...e)}doLog(e,...t){var i;if(!this.logger[e])throw new Error("TencentDocsWebOfficeSDK ERROR: console[level] not exist");const n=[`[${Date.now()}]`,`[${_e()}]`,`[${this.name}]`,`[${e.toUpperCase()}]`,`\n${t[0]}`,...t.slice(1)];this.logger[e](`%c${e.toUpperCase()}%c${B} ${_e()} ${Date.now()}`,Re(e),Re("logType"),`\n${t[0]}`,...t.slice(1)),null===(i=window.__TencentDocs_WebOffice_LogCollection__)||void 0===i||i.write(n,e)}}(B);class Ce extends Error{constructor(e,t){var i;super(e,t),super.name=`[${_e()}] ${B} ERROR`;const{retcode:n}=null!=t?t:{};ae(n)&&(this.retcode=n),null===(i=window.__TencentDocs_WebOffice_LogCollection__)||void 0===i||i.write([this.stack],Ee.ERROR)}}function Pe(e,t){if(!e)throw new Ce(t||"")}function Ae(e){Pe(!1,e)}const Le=Symbol("IEventEmitter"),xe=()=>{const e={all:t=(t=new Map)||new Map,on:function(e,i){var n=t.get(e);n?n.push(i):t.set(e,[i])},off:function(e,i){var n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var n=t.get(e);n&&n.slice().map((function(e){e(i)})),(n=t.get("*"))&&n.slice().map((function(t){t(e,i)}))}};var t;return Object.assign(Object.assign({},e),{once:(t,i)=>{const n=r=>{i(r),e.off(t,n)};e.on(t,n)},dispose:()=>{e.all.clear()}})},De="detect-connection-api";class Fe{constructor(e){this.rpc=e,this.name=De}execute(e){return f(this,void 0,void 0,(function*(){const[t,i]=yield this.rpc.call(this.name,null==e?void 0:e.needClose),n=null==i?void 0:i.message.includes(H),r=(null==e?void 0:e.retryTime)&&e.retryTime>0;return n&&r?(Te.warn("detect-connection retry"),this.execute({retryTime:e.retryTime-1})):!i&&t}))}}class je{constructor(e){this.rpc=e,this.name=De}run(e){if(!e)return!0;this.rpc.dispose()}}const ke=Symbol("IRpc"),Ne="TENCENT_WEB_OFFICE_SDK_",We=ye("debug");class Me{constructor(e,t={}){this.targetWindow=e,this.id=`${Ne}${pe()}`,this.apiListener=new Map,this.requestListener=new Map,this.timeout=2e3,this.handler=e=>{this.lastCommunicateTime=Date.now();const t=e.data;if(this.isRequestData(t))if(this.isValidResponse(t)){this.lastCommunicateTime=Date.now();const e=this.getListenerKey(t);if(this.requestListener.has(e)){this.requestListener.get(e)(t)}}else if(this.isValidRequest(t)){this.lastCommunicateTime=Date.now();const{api:e}=t;if(this.debugInfo(`run api: ${e}, exist:`,this.apiListener.has(e)),this.apiListener.has(e)){const i=this.apiListener.get(e);(()=>f(this,void 0,void 0,(function*(){try{const e=yield i.run(t.body);t.result=e}catch(e){t.error=e}finally{t.done=this.id}try{this.targetWindow.postMessage(t,"*")}catch(i){Te.warn(`[rpc] [id: ${this.id}] [${e}] [rpc run error] [postMessage error]`,i),t.result=void 0,t.error=i,this.targetWindow.postMessage(t,"*")}})))()}else Te.error(`[rpc] [id: ${this.id}] [rpc handler] API:${e} does not exist!`,t)}},this.headers={};const{targetId:i,selfId:n,timeout:r}=t;i&&(this.targetId=`${Ne}${i}`),n&&(this.id=`${Ne}${n}`),ae(r)&&r>0&&(this.timeout=r),window.addEventListener("message",this.handler),this.addApi(new je(this)),this.debugInfo("new Rpc",this)}call(e,t){return de(new Promise(((i,n)=>{const r=t=>{this.debugInfo(`api [${e}] resolve, result:`,t),i(t)},o=t=>{this.debugInfo(`api [${e}] reject, error:`,t),n(t)},s=this.createRequestData(e,t),a=this.getListenerKey(s);this.debugInfo(`call api: ${e}, requestData:`,s);const c=setTimeout((()=>{o(new Ce(H+e)),this.requestListener.delete(a)}),this.timeout);this.requestListener.set(a,(e=>{clearTimeout(c);const{result:t,error:i}=e;i?o(i):r(t),this.requestListener.delete(a)}));try{this.targetWindow.postMessage(s,"*")}catch(t){const i=`[rpc] [id: ${this.id}] [${e}] [rpc execute error] [postMessage error]`;Te.error(i,t),clearTimeout(c),o(new Ce(i)),this.requestListener.delete(a)}})))}isConnected(e){return f(this,void 0,void 0,(function*(){if(this.lastCommunicateTime&&Date.now()-this.lastCommunicateTime<1e3)return!0;return yield new Fe(this).execute(e)}))}closeServer(){new Fe(this).execute({needClose:!0})}addApi(e){this.apiListener.set(e.name,e)}getApi(e){return this.apiListener.get(e)}clearApi(){this.apiListener.clear()}setHeaders(e){return this.headers=Object.assign(Object.assign({},this.headers),e),this}dispose(){window.removeEventListener("message",this.handler),this.clearApi()}createRequestData(e,t){return{api:e,from:this.id,requestId:pe(),timeStamp:Date.now(),headers:this.headers,body:t}}isRequestData(e){return!!le(e)&&(!!("from"in e&&ce(e.from)&&e.from.startsWith(Ne))&&("timeStamp"in e&&"headers"in e))}isValidResponse(e){const t=e.done&&e.from===this.id;return this.targetId?t&&e.done===this.targetId:t}isValidRequest(e){const t=e.from!==this.id&&!e.done;return this.targetId?t&&e.from===this.targetId:t}getListenerKey(e){return`${e.from}_${e.api}_${e.requestId}`}debugInfo(...e){We&&Te.info(`[rpc] [id: ${this.id}]`,e)}}const $e="1.2.31",Ue="webOfficeVersion",Ke="webOfficeNative",Ve=e=>"string"==typeof e&&/^(\d+|x)\.(\d+|x)+\.(\d+|x)$/.test(e);function He(){const e=!!function(){const e=new URLSearchParams(location.search).get(Ue);return Ve(e)?e:null}();return(parent&&self!==parent||!!new URLSearchParams(location.search).get(Ke))&&e}var Be;!function(e){e.OnInit="OnInit",e.OnOpen="OnOpen",e.OnDestroy="OnDestroy"}(Be||(Be={}));class qe{constructor(e){this.rpc=e,this.name="get-file-info-api"}execute(e){return f(this,void 0,void 0,(function*(){const[t,i]=yield this.rpc.call(this.name,e);if(i)throw i;return t}))}}const Xe="event-api";class ze{constructor(e){this.eventEmitter=e,this.name=Xe}run(e){Te.log("EventApi",e),this.eventEmitter.emit(e.messageType,e)}}class Ge{constructor(e){const{messageType:t,data:i}=e;this.messageType=t,this.data=i}}He();class Qe{constructor(e,t){this.stateService=e,this.rpc=t,this.name="update-cac-config-api"}execute(e){return f(this,void 0,void 0,(function*(){yield this.stateService.whenApplicationReady();const[t,i]=yield this.rpc.call(this.name,e);return!i&&t}))}}var Ye={"Âú®Á∫øÈ¢ÑËßàÂä†ËΩΩ‰∏≠...":"Online preview loading...","ÊàêÂäü":"Success","Êñá‰ª∂‰∏çÂ≠òÂú®":"File does not exist","Á≠æÂêçÊó†Êïà":"Invalid signature","ËØ∑Ê±ÇÂèÇÊï∞‰∏çÂêàÊ≥ï":"The request parameter is illegal","Êñá‰ª∂ÈúÄË¶ÅÂØÜÁ†Å":"File requires password","Ê∫êÊñá‰ª∂‰∏ãËΩΩÂ§±Ë¥•":"Source file download failed","Êñá‰ª∂ÂØºÂÖ•Êú™ÂÆåÊàêÔºåËØ∑Á®çÂêéÈáçËØï":"File import not completed, please try again later","ÊöÇ‰∏çÊîØÊåÅËØ•Á±ªÂûãÊñá‰ª∂ÁöÑÈ¢ÑËßà":"Preview of this type of file is not currently supported","Á≥ªÁªüÂÜÖÈÉ®ÈîôËØØ":"System internal error","Áî®Êà∑Ë∫´‰ªΩÈîôËØØ":"User identity error","Êñá‰ª∂Ë∂ÖÂá∫‰∫ÜÂ§ßÂ∞èÈôêÂà∂":"File exceeds size limit","ÊñáÊ°£Êó†Êõ¥Êñ∞ÔºåÊó†ÈúÄ‰øùÂ≠ò":"The document is not updated and does not need to be saved","ËÆ∏ÂèØËØÅÂ∑≤ËøáÊúüÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÂ§ÑÁêÜ":"The license has expired, please contact the administrator for processing","ÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï":"Import failed, please try again later","Êñá‰ª∂ËøáÊúü":"File expired","ËÆ∏ÂèØËØÅËøáÊúü":"License expired","Â∫îÁî®‰∏çÂêàÊ≥ï":"The application is illegal","ÁôªÂΩïÊÄÅÊ†°È™åÂ§±Ë¥•":"Login status verification failed"},Je={"Âú®Á∫øÈ¢ÑËßàÂä†ËΩΩ‰∏≠...":"Âú®Á∫øÈ¢ÑËßàÂä†ËΩΩ‰∏≠...","ÊàêÂäü":"ÊàêÂäü","Êñá‰ª∂‰∏çÂ≠òÂú®":"Êñá‰ª∂‰∏çÂ≠òÂú®","Á≠æÂêçÊó†Êïà":"Á≠æÂêçÊó†Êïà","ËØ∑Ê±ÇÂèÇÊï∞‰∏çÂêàÊ≥ï":"ËØ∑Ê±ÇÂèÇÊï∞‰∏çÂêàÊ≥ï","Êñá‰ª∂ÈúÄË¶ÅÂØÜÁ†Å":"Êñá‰ª∂ÈúÄË¶ÅÂØÜÁ†Å","Ê∫êÊñá‰ª∂‰∏ãËΩΩÂ§±Ë¥•":"Ê∫êÊñá‰ª∂‰∏ãËΩΩÂ§±Ë¥•","Êñá‰ª∂ÂØºÂÖ•Êú™ÂÆåÊàêÔºåËØ∑Á®çÂêéÈáçËØï":"Êñá‰ª∂ÂØºÂÖ•Êú™ÂÆåÊàêÔºåËØ∑Á®çÂêéÈáçËØï","ÊöÇ‰∏çÊîØÊåÅËØ•Á±ªÂûãÊñá‰ª∂ÁöÑÈ¢ÑËßà":"ÊöÇ‰∏çÊîØÊåÅËØ•Á±ªÂûãÊñá‰ª∂ÁöÑÈ¢ÑËßà","Á≥ªÁªüÂÜÖÈÉ®ÈîôËØØ":"Á≥ªÁªüÂÜÖÈÉ®ÈîôËØØ","Áî®Êà∑Ë∫´‰ªΩÈîôËØØ":"Áî®Êà∑Ë∫´‰ªΩÈîôËØØ","Êñá‰ª∂Ë∂ÖÂá∫‰∫ÜÂ§ßÂ∞èÈôêÂà∂":"Êñá‰ª∂Ë∂ÖÂá∫‰∫ÜÂ§ßÂ∞èÈôêÂà∂","ÊñáÊ°£Êó†Êõ¥Êñ∞ÔºåÊó†ÈúÄ‰øùÂ≠ò":"ÊñáÊ°£Êó†Êõ¥Êñ∞ÔºåÊó†ÈúÄ‰øùÂ≠ò","ËÆ∏ÂèØËØÅÂ∑≤ËøáÊúüÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÂ§ÑÁêÜ":"ËÆ∏ÂèØËØÅÂ∑≤ËøáÊúüÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÂ§ÑÁêÜ","ÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï":"ÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","Êñá‰ª∂ËøáÊúü":"Êñá‰ª∂ËøáÊúü","ËÆ∏ÂèØËØÅËøáÊúü":"ËÆ∏ÂèØËØÅËøáÊúü","Â∫îÁî®‰∏çÂêàÊ≥ï":"Â∫îÁî®‰∏çÂêàÊ≥ï","ÁôªÂΩïÊÄÅÊ†°È™åÂ§±Ë¥•":"ÁôªÂΩïÊÄÅÊ†°È™åÂ§±Ë¥•"},Ze={"Âú®Á∫øÈ¢ÑËßàÂä†ËΩΩ‰∏≠...":"Á∑ö‰∏äÈ†êË¶ΩËºâÂÖ•‰∏≠...","ÊàêÂäü":"ÊàêÂäü","Êñá‰ª∂‰∏çÂ≠òÂú®":"Êñá‰ª∂‰∏çÂ≠òÂú®","Á≠æÂêçÊó†Êïà":"Á∞ΩÂêçÁÑ°Êïà","ËØ∑Ê±ÇÂèÇÊï∞‰∏çÂêàÊ≥ï":"Ë´ãÊ±ÇÂèÉÊï∏‰∏çÂêàÊ≥ï","Êñá‰ª∂ÈúÄË¶ÅÂØÜÁ†Å":"Êñá‰ª∂ÈúÄË¶ÅÂØÜÁ¢º","Ê∫êÊñá‰ª∂‰∏ãËΩΩÂ§±Ë¥•":"ÂéüÂßãÊ™î‰∏ãËºâÂ§±Êïó","Êñá‰ª∂ÂØºÂÖ•Êú™ÂÆåÊàêÔºåËØ∑Á®çÂêéÈáçËØï":"Êñá‰ª∂Â∞éÂÖ•Êú™ÂÆåÊàêÔºåË´ãÁ®çÂæåÈáçË©¶","ÊöÇ‰∏çÊîØÊåÅËØ•Á±ªÂûãÊñá‰ª∂ÁöÑÈ¢ÑËßà":"Êö´‰∏çÊîØÊè¥Ë©≤È°ûÂûãÊñá‰ª∂ÁöÑÈ†êË¶Ω","Á≥ªÁªüÂÜÖÈÉ®ÈîôËØØ":"Á≥ªÁµ±ÂÖßÈÉ®ÈåØË™§","Áî®Êà∑Ë∫´‰ªΩÈîôËØØ":"‰ΩøÁî®ËÄÖË∫´‰ªΩÈåØË™§","Êñá‰ª∂Ë∂ÖÂá∫‰∫ÜÂ§ßÂ∞èÈôêÂà∂":"Êñá‰ª∂Ë∂ÖÂá∫‰∫ÜÂ§ßÂ∞èÈôêÂà∂","ÊñáÊ°£Êó†Êõ¥Êñ∞ÔºåÊó†ÈúÄ‰øùÂ≠ò":"Êñá‰ª∂ÁÑ°Êõ¥Êñ∞ÔºåÁÑ°ÈúÄÂÑ≤Â≠ò","ËÆ∏ÂèØËØÅÂ∑≤ËøáÊúüÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÂ§ÑÁêÜ":"Ë®±ÂèØË≠âÂ∑≤ÈÅéÊúüÔºåË´ãËÅØÁµ°ÁÆ°ÁêÜÂì°ËôïÁêÜ","ÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï":"Â∞éÂÖ•Â§±ÊïóÔºåË´ãÁ®çÂæåÈáçË©¶","Êñá‰ª∂ËøáÊúü":"Êñá‰ª∂ÈÅéÊúü","ËÆ∏ÂèØËØÅËøáÊúü":"Ë®±ÂèØË≠âÈÅéÊúü","Â∫îÁî®‰∏çÂêàÊ≥ï":"ÊáâÁî®‰∏çÂêàÊ≥ï","ÁôªÂΩïÊÄÅÊ†°È™åÂ§±Ë¥•":"ÁôªÈåÑÊÖãÊ†°È©óÂ§±Êïó"};const et=new class{constructor(){this.translations={zh:Je,en:Ye,"zh-CN":Je,"zh-HK":Ze,"en-US":Ye},this.currentLang=this.getUADefaultLang()}setLanguage(e){this.currentLang=this.translations[e]?e:this.getUADefaultLang()}translate(e){var t;return(null===(t=this.translations[this.currentLang])||void 0===t?void 0:t[e])||e}getUADefaultLang(){return this.translations[navigator.language]?navigator.language:"zh-CN"}},tt=e=>et.translate(e);var it;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.SIGN_ERROR=11112]="SIGN_ERROR",e[e.FILE_TOKEN_ERROR=12607]="FILE_TOKEN_ERROR",e[e.FILE_NOT_EXIST=11510]="FILE_NOT_EXIST",e[e.PARAMS_ERROR=11607]="PARAMS_ERROR",e[e.NEED_FILE_PWD=402702]="NEED_FILE_PWD",e[e.SERVER_ERROR=5e4]="SERVER_ERROR",e[e.FILE_DOWNLOAD_FAIL=402708]="FILE_DOWNLOAD_FAIL",e[e.FILE_TYPE_NOT_SUPPORT=402707]="FILE_TYPE_NOT_SUPPORT",e[e.FILE_IMPORT_NOT_FINISH=402701]="FILE_IMPORT_NOT_FINISH",e[e.FILE_SIZE_EXCEEDED=402703]="FILE_SIZE_EXCEEDED",e[e.APP_ERROR=402761]="APP_ERROR",e[e.TOKEN_CHECK_ERROR=402721]="TOKEN_CHECK_ERROR",e[e.FILE_UN_CHANGE=402782]="FILE_UN_CHANGE",e[e.LICENSE_EXPIRED=56032]="LICENSE_EXPIRED",e[e.ERR_FILE_IMPORT_FILED=402704]="ERR_FILE_IMPORT_FILED",e[e.ERR_FILE_NOT_EXIST=402705]="ERR_FILE_NOT_EXIST",e[e.ERR_FILE_EXPIRED=402706]="ERR_FILE_EXPIRED",e[e.PLATFORM_LICENSE_EXPIRED=408907]="PLATFORM_LICENSE_EXPIRED",e[e.EXCEED_MAX_CONCURRENCY=408908]="EXCEED_MAX_CONCURRENCY"}(it||(it={}));const nt={[it.SUCCESS]:tt("ÊàêÂäü"),[it.FILE_NOT_EXIST]:tt("Êñá‰ª∂‰∏çÂ≠òÂú®"),[it.ERR_FILE_NOT_EXIST]:tt("Êñá‰ª∂‰∏çÂ≠òÂú®"),[it.SIGN_ERROR]:tt("Á≠æÂêçÊó†Êïà"),[it.PARAMS_ERROR]:tt("ËØ∑Ê±ÇÂèÇÊï∞‰∏çÂêàÊ≥ï"),[it.NEED_FILE_PWD]:tt("Êñá‰ª∂ÈúÄË¶ÅÂØÜÁ†Å"),[it.FILE_DOWNLOAD_FAIL]:tt("Ê∫êÊñá‰ª∂‰∏ãËΩΩÂ§±Ë¥•"),[it.FILE_IMPORT_NOT_FINISH]:tt("Êñá‰ª∂ÂØºÂÖ•Êú™ÂÆåÊàêÔºåËØ∑Á®çÂêéÈáçËØï"),[it.FILE_TYPE_NOT_SUPPORT]:tt("ÊöÇ‰∏çÊîØÊåÅËØ•Á±ªÂûãÊñá‰ª∂ÁöÑÈ¢ÑËßà"),[it.SERVER_ERROR]:tt("Á≥ªÁªüÂÜÖÈÉ®ÈîôËØØ"),[it.FILE_TOKEN_ERROR]:tt("Áî®Êà∑Ë∫´‰ªΩÈîôËØØ"),[it.FILE_SIZE_EXCEEDED]:tt("Êñá‰ª∂Ë∂ÖÂá∫‰∫ÜÂ§ßÂ∞èÈôêÂà∂"),[it.FILE_UN_CHANGE]:tt("ÊñáÊ°£Êó†Êõ¥Êñ∞ÔºåÊó†ÈúÄ‰øùÂ≠ò"),[it.LICENSE_EXPIRED]:tt("ËÆ∏ÂèØËØÅÂ∑≤ËøáÊúüÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÂ§ÑÁêÜ"),[it.ERR_FILE_IMPORT_FILED]:tt("ÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï"),[it.ERR_FILE_EXPIRED]:tt("Êñá‰ª∂ËøáÊúü"),[it.PLATFORM_LICENSE_EXPIRED]:tt("ËÆ∏ÂèØËØÅËøáÊúü"),[it.EXCEED_MAX_CONCURRENCY]:tt("Ë∂ÖËøáÊúÄÂ§ßÂπ∂ÂèëÊï∞"),[it.APP_ERROR]:tt("Â∫îÁî®‰∏çÂêàÊ≥ï"),[it.TOKEN_CHECK_ERROR]:tt("ÁôªÂΩïÊÄÅÊ†°È™åÂ§±Ë¥•")};var rt;!function(e){e[e.HAS_OFFLINE_DATA_NOT_SAVE=1e6]="HAS_OFFLINE_DATA_NOT_SAVE"}(rt||(rt={}));const ot=function e(t){function i(e,t,n){var r,o={};if(Array.isArray(e))return e.concat(t);for(r in e)o[n?r.toLowerCase():r]=e[r];for(r in t){var s=n?r.toLowerCase():r,a=t[r];o[s]=s in o&&"object"==typeof a?i(o[s],a,"headers"==s):a}return o}function n(e,n,r,o,s){var a="string"!=typeof e?(n=e).url:e,c={config:n},l=i(t,n),u={};o=o||l.data,(l.transformRequest||[]).map((function(e){o=e(o,l.headers)||o})),l.auth&&(u.authorization=l.auth),o&&"object"==typeof o&&"function"!=typeof o.append&&"function"!=typeof o.text&&(o=JSON.stringify(o),u["content-type"]="application/json");try{u[l.xsrfHeaderName]=decodeURIComponent(document.cookie.match(RegExp("(^|; )"+l.xsrfCookieName+"=([^;]*)"))[2])}catch(e){}return l.baseURL&&(a=a.replace(/^(?!.*\/\/)\/?/,l.baseURL+"/")),l.params&&(a+=(~a.indexOf("?")?"&":"?")+(l.paramsSerializer?l.paramsSerializer(l.params):new URLSearchParams(l.params))),(l.fetch||fetch)(a,{method:(r||l.method||"get").toUpperCase(),body:o,headers:i(l.headers,u,!0),credentials:l.withCredentials?"include":s}).then((function(e){for(var t in e)"function"!=typeof e[t]&&(c[t]=e[t]);return"stream"==l.responseType?(c.data=e.body,c):e[l.responseType||"text"]().then((function(e){c.data=e,c.data=JSON.parse(e)})).catch(Object).then((function(){return(l.validateStatus?l.validateStatus(e.status):e.ok)?c:Promise.reject(c)}))}))}return t=t||{},n.request=n,n.get=function(e,t){return n(e,t,"get")},n.delete=function(e,t){return n(e,t,"delete")},n.head=function(e,t){return n(e,t,"head")},n.options=function(e,t){return n(e,t,"options")},n.post=function(e,t,i){return n(e,i,"post",t)},n.put=function(e,t,i){return n(e,i,"put",t)},n.patch=function(e,t,i){return n(e,i,"patch",t)},n.all=Promise.all.bind(Promise),n.spread=function(e){return e.apply.bind(e,e)},n.CancelToken="function"==typeof AbortController?AbortController:Object,n.defaults=t,n.create=e,n}().create({withCredentials:!0});class st{constructor(e){this.params=e}send(){return f(this,void 0,void 0,(function*(){const{endpoint:e,queries:t,payload:i}=this.params,n=`${e}${this.cgiPath}${t?`?${new URLSearchParams(t).toString()}`:""}`;return this.request(n,i)}))}}function at(e){return f(this,void 0,void 0,(function*(){const{appId:t,fileId:i,fileToken:n,disableCacheToken:r,endpoint:o,enableRequestCache:s}=e;if(!n||r)return null;const a=pt(e);if(s&&a)return at(Object.assign(Object.assign({},e),{enableRequestCache:!1})),Te.log("[cache_token] return cache",a),a;const c=function(e){const t=Date.now();return se(`${e}_${t}_${pe()}`)}(t),l={endpoint:ve(o),payload:{token_cache_key:c,wo_user_token:n},headers:Object.assign({},i&&{"X-Third-FileID":i})},[,u]=yield de((p=l,new ct(p).send()));var p;return u?(Te.error("cacheToken Error:",u),null):(function(e,t){var i;if(!t||!ce(t))return;const n=null!==(i=pt())&&void 0!==i?i:{},r=dt(e);n[r]={tokenKey:t,expireTime:Date.now()+lt};try{localStorage.setItem(ut,JSON.stringify(n))}catch(e){Te.error("[cache_token] [setCache] Error:",e),localStorage.removeItem(ut)}}(e,c),c)}))}let ct=class extends st{constructor(){super(...arguments),this.cgiPath="/api/weboffice/cache_token"}request(e,t){return f(this,void 0,void 0,(function*(){const{headers:i}=this.params,{data:n}=yield ot.post(e,t,{headers:i}),{retcode:r,result:o}=n;if(0!==r||!o)throw new Ce(nt[r]||n.msg,{retcode:r});return o}))}};const lt=6e5,ut="WOB_catch_token";function pt(e){try{const t=localStorage.getItem(ut);if(!t)return null;const i=JSON.parse(t);if(!e)return i;const n=dt(e),r=i[n];return!(null==r?void 0:r.expireTime)||r.expireTime<=Date.now()?(delete i[n],localStorage.setItem(ut,JSON.stringify(i)),null):r.tokenKey}catch(e){return Te.error("[cache_token] [getCache] Error:",e),localStorage.removeItem(ut),null}}function dt(e){const{fileId:t,fileToken:i}=e;return`${t}_${i}`}let ft=G;function ht(e){return f(this,void 0,void 0,(function*(){const{endpoint:t,enablePreheatContainer:i}=e;if(!ge(e.endpoint)||!i)return!1;if(ft!==G)return ft;const n={endpoint:ve(t),payload:{},headers:{"Content-Type":"application/json"}};try{const e=yield new vt(n).send();return ft=e.graySwitch}catch(e){return Te.warn("Failed to fetch gray status:",null==e?void 0:e.message),ft=!1}}))}let vt=class extends st{constructor(){super(...arguments),this.cgiPath="/gw/gray/get-switch"}request(e,t){return f(this,void 0,void 0,(function*(){const{headers:t}=this.params,{data:i}=yield ot.get(e,{headers:t});return i}))}};function gt(e,t){const{docsConfig:i,language:n,toolbarMode:r,srcParams:o,appId:s,srcFormatter:a}=t,c=new URL(e);c.searchParams.set("_o_appId",s),c.searchParams.set(Ue,$e),c.searchParams.set("nologin","1"),!1===(null==i?void 0:i.statusbar)&&c.searchParams.set("hideStatusbar","1"),!1===(null==i?void 0:i.titlebar)&&c.searchParams.set("hideTitlebar","1"),!1===(null==i?void 0:i.toolbar)&&c.searchParams.set("hideToolbar","1"),n&&c.searchParams.set("lng",n),r&&c.searchParams.set("toolbarMode",r);const l=be(t.customParams),u=be(t.customHeaders);if(l&&c.searchParams.set("wo_custom_params",l),u&&c.searchParams.set("wo_custom_headers",u),ye("debug")&&c.searchParams.set("debug","1"),o){const e=o instanceof URLSearchParams?o:new URLSearchParams(o);for(const[t,i]of e.entries())c.searchParams.set(t,i)}return a?a(c.toString()):c.toString()}const yt=Symbol("IConfig");var mt;!function(e){e.DOC="doc",e.DOCX="docx",e.TXT="txt",e.CSV="csv",e.XLS="xls",e.XLSX="xlsx",e.PPT="ppt",e.PPTX="pptx",e.PDF="pdf",e.OFD="ofd"}(mt||(mt={}));let wt=class{constructor(e){var t;this._config=e;const{fileToken:i,appId:n}=this._config;e.language&&et.setLanguage(e.language);const r=Oe(e),o=Object.assign({"X-WebOffice-Token":i,"X-App-Id":n,"X-Xsrf-Token":"root:xsrfToken"},r&&{"X-WebOffice-Query":r});this._config.docsConfig=Object.assign(Object.assign({},null!==(t=this._config.docsConfig)&&void 0!==t?t:{}),{weboffice:{headers:o}})}get config(){return this._config}set config(e){this._config=e}setHeaders(e,t){var i;if(!t||!e)return;const{docsConfig:n}=this._config;(null===(i=null==n?void 0:n.weboffice)||void 0===i?void 0:i.headers)&&(n.weboffice.headers[e]=t)}isOpenOfficeId(e){return"fileId"in e}isOpenOfficeFile(e){return!this.isOpenOfficeId(e)&&"file"in e}isOpenTencentdoc(e){return!this.isOpenOfficeId(e)&&!this.isOpenOfficeFile(e)&&"tencentdocUrl"in e}};wt=u([K(),p(0,$(yt)),d("design:paramtypes",[Object])],wt);let _t=class{constructor(e,t){this.ApiEvent=e,this.rpc=t,this.documentVersion="",this.applicationReadyBarrier=new Se,this.applicationServerReadyBarrier=new Se,this.init()}whenApplicationServerReady(e){return f(this,void 0,void 0,(function*(){var t;yield this.applicationServerReadyBarrier.wait(),!1!==(null==e?void 0:e.needConnection)&&((yield this.rpc.isConnected({retryTime:null!==(t=null==e?void 0:e.retryTime)&&void 0!==t?t:5}))||Ae(`[whenApplicationServerReady] never: not connected, isApplicationServerReady: ${this.applicationServerReadyBarrier.isOpen()}`))}))}whenApplicationReady(e){return f(this,void 0,void 0,(function*(){var t;yield this.applicationReadyBarrier.wait(),!1!==(null==e?void 0:e.needConnection)&&((yield this.rpc.isConnected({retryTime:null!==(t=null==e?void 0:e.retryTime)&&void 0!==t?t:5}))||Ae(`[whenApplicationReady] never: not connected, isApplicationReady: ${this.applicationReadyBarrier.isOpen()}`))}))}reset(){(this.applicationReadyBarrier.isOpen()||this.applicationServerReadyBarrier.isOpen())&&(this.applicationReadyBarrier=new Se,this.applicationServerReadyBarrier=new Se)}init(){this.ApiEvent.on("AfterBootstrap",(e=>{var t;const{version:i}=null!==(t=e.data)&&void 0!==t?t:{};this.applicationReadyBarrier.open(),this.documentVersion=null!=i?i:"",i&&Te.log("Web-Office-Document Version:",i)})),this.ApiEvent.on("AfterStartWebOfficeApplicationServer",(()=>this.applicationServerReadyBarrier.open()))}};_t=u([K(),p(0,$(Le)),p(1,$(ke)),d("design:paramtypes",[Object,Me])],_t);class bt{constructor(e){this.name=e,this.startTime=Date.now(),this.entryType="mark"}}let St=class{constructor(){this._entry=[]}mark(e){const t=new bt(e);return this._entry.push(t),t}getDuration(e,t){const i=this.findEntry(e);if(!i)return 0;const n=this.findEntry(t);return n?n.startTime-i.startTime:0}findEntry(e,t){for(let i=this._entry.length-1;i>=0;i--){const n=this._entry[i],r=t&&n.entryType===t||!t;if(n.name===e&&r)return n}}getAllPerformance(){return this._entry.map((e=>({name:e.name,startTime:e.startTime})))}};St=u([K()],St);const Ot=["fullscreen","camera","clipboard-read","clipboard-write"];class Et{constructor(e){var t;this.iframeName=`WEB_OFFICE_INSTANCE_${pe()}`;const i=[...new Set(Ot.concat(null!==(t=e.allowList)&&void 0!==t?t:[]))].join("; ");this.iframe=document.createElement("iframe"),this.iframe.name=this.iframeName,this.iframe.height="100%",this.iframe.width="100%",this.iframe.setAttribute("referrerpolicy","origin"),this.iframe.setAttribute("webkitallowfullscreen","true"),this.iframe.setAttribute("mozallowfullscreen","true"),this.iframe.setAttribute("allow",i),this.iframe.style.background="#FFF",this.iframe.style.border="0",this.iframe.style.overflow="auto",this.iframe.classList.add("iframe-hide-scrollbar");const n=document.createElement("style");n.textContent="\n      .iframe-hide-scrollbar {\n        scrollbar-width: none;\n      }\n      .iframe-hide-scrollbar::-webkit-scrollbar {\n        display: none;\n        width: 0 !important;\n        height: 0 !important;\n      }\n    ",document.head.appendChild(n)}appendTo(e){he(e).append(this.iframe)}dispose(){var e;this.iframe.src="about:blank",null===(e=this.iframe.contentWindow)||void 0===e||e.close(),this.iframe.remove()}}class It{constructor(e,t){this.container=e;const i=document.createElement("div");var n;i.style.cssText=(n={position:"absolute",width:"calc(100% - 40px)",height:"100%",padding:"0 20px","padding-top":"20%",justifyContent:"center",color:"rgba(0,0,0,0.64)",backgroundColor:"#fff",fontSize:"14px",lineHeight:"20px",display:"flex",zIndex:"1"},Object.entries(n).map((([e,t])=>`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${t};`)).join("")),this.tipDom=null!=t?t:{showTip:(e,t)=>{i.innerText=e,t.insertBefore(i,t.firstChild)},hideTip:()=>{setTimeout((()=>{i.remove()}),300)}}}showTip(e){this.tipDom.showTip(e,this.container)}hideTip(){this.tipDom.hideTip()}}let Rt=class{constructor(e){this.config=e;const{mount:t,loadingUI:i}=this.config,n=document.createElement("div");this.container=n,n.className="TENCENT_DOC_WEBOFFICE",this.hideUI();he(t).append(n),this.iframeInstance=new Et(this.config),this.iframeInstance.appendTo(n),this.tipsInstance=new It(n,i)}hideUI(){this.container.style.width="1px",this.container.style.height="1px",this.container.style.position="absolute",this.container.style.left="-9999px",this.container.style.top="0",this.container.style.overflow="hidden",this.container.style.pointerEvents="none",this.container.style.margin="0",this.container.style.padding="0"}showUI(){this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.left="",this.container.style.top="",this.container.style.overflow="",this.container.style.pointerEvents="",this.container.style.margin="",this.container.style.padding=""}dispose(){this.container.remove(),this.iframeInstance.dispose(),this.tipsInstance.hideTip()}};Rt=u([K(),p(0,$(yt)),d("design:paramtypes",[Object])],Rt);let Tt=class{constructor(e,t,i,n,r){this.configService=e,this.timerService=t,this.stateService=i,this.rpc=n,this.uiService=r,this.openUrl=""}open(e){this.stateService.reset(),this.timerService.mark("WebOffice/BeforeOpenIframe"),this.openUrl=this.handleConfigToUrl(e),this.uiService.iframeInstance.iframe.src&&this.rpc.closeServer(),this.uiService.iframeInstance.iframe.src=this.openUrl}getDocType(){var e;return null!==(e=me(this.openUrl))&&void 0!==e?e:""}handleConfigToUrl(e){return Te.log("üöÄ ~ OpenService ~ handleConfigToUrl ~ docsConfig:",this.configService.config.docsConfig),gt(e,this.configService.config)}};function Ct(e){const{appId:t,signature:i,fileToken:n,fileId:r,officeType:o,endpoint:s,version:a,disableRequestHeader:c,enableRequestCache:l}=e,{sign:u,timeStamp:p,nonce:d}=i,f=Oe(e),h={endpoint:ve(s),payload:{wo_app_id:t,timestamp:String(p),nonce:d,signature:u,file_id:r,wo_user_token:n,ext:o,version:a},headers:c?{}:Object.assign(Object.assign({"X-App-Id":t,"X-Third-FileID":r},n&&{"X-WebOffice-Token":n}),f&&{"X-WebOffice-Query":f})};return l?new At(h).send():new Pt(h).send()}Tt=u([K(),p(3,$(ke)),d("design:paramtypes",[wt,St,_t,Me,Rt])],Tt);let Pt=class extends st{constructor(){super(...arguments),this.cgiPath="/api/weboffice/async_import"}request(e,t){return f(this,void 0,void 0,(function*(){const{headers:i}=this.params,{data:n}=yield ot.post(e,t,{headers:i}),{retcode:r,result:o}=n;if(0!==r||!o)throw new Ce(nt[r]||n.msg,{retcode:r});return o}))}};class At extends st{constructor(){super(...arguments),this.cgiPath="/api/weboffice/async_import",this.storageKey="WOB_async_import"}request(e,t){return f(this,void 0,void 0,(function*(){const i=this.fetchNewData(e,t),n=this.getCache(t);return n?(Te.log("[async_import] return cache",n),n):i}))}fetchNewData(e,t){return f(this,void 0,void 0,(function*(){const{headers:i}=this.params,{data:n}=yield ot.post(e,t,{headers:i}),{retcode:r,result:o}=n;if(0!==r||!o)throw this.removeCache(t),new Ce(nt[r]||n.msg,{retcode:r});return!0===o.cached&&this.setCache(t,o),o}))}setCache(e,t){var i;if(!0!==t.cached)return;const n=null!==(i=this.getCache())&&void 0!==i?i:{};n[this.getKey(e)]=Object.assign(Object.assign({},t),{expireTime:Date.now()+6e5});try{localStorage.setItem(this.storageKey,JSON.stringify(n))}catch(e){Te.error("[async_import] [setCache] Error:",e),this.removeCache()}}getCache(e){try{const t=localStorage.getItem(this.storageKey);if(!t)return null;const i=JSON.parse(t);if(!e)return i;const n=this.getKey(e),r=i[n];return!(null==r?void 0:r.expireTime)||r.expireTime<=Date.now()?(delete i[n],localStorage.setItem(this.storageKey,JSON.stringify(i)),null):r}catch(e){return Te.error("[async_import] [getCache] Error:",e),this.removeCache(),null}}removeCache(e){if(!e)return void localStorage.removeItem(this.storageKey);const t=localStorage.getItem(this.storageKey);if(!t)return;const i=JSON.parse(t);delete i[this.getKey(e)],localStorage.setItem(this.storageKey,JSON.stringify(i))}getKey(e){const{file_id:t,wo_app_id:i}=e;return`${t}_${i}`}}var Lt;!function(e){e[e.Not_Finish=402701]="Not_Finish"}(Lt||(Lt={}));const xt=e=>e.retcode===Lt.Not_Finish;function Dt(e){return new Ft(e).send()}let Ft=class extends st{constructor(){super(...arguments),this.cgiPath="/api/weboffice/query"}request(e,t){return f(this,void 0,void 0,(function*(){const{headers:i}=this.params,{data:n}=yield ot.post(e,t,{headers:i});return n}))}};let jt=class extends st{constructor(){super(...arguments),this.cgiPath="/api/weboffice/save"}request(e,t){return f(this,void 0,void 0,(function*(){var i;const{data:n}=yield ot.post(e,t,{headers:null!==(i=this.params.headers)&&void 0!==i?i:{}}),{retcode:r}=n;return 0!==r&&Te.error(nt[r]||n.msg),n.msg=nt[r]||n.msg,n}))}};class kt extends st{constructor(){super(...arguments),this.cgiPath="/api/weboffice/upload_pre"}request(e,t){return f(this,void 0,void 0,(function*(){const{data:i}=yield ot.post(e,t);return i}))}}var Nt;function Wt(e){const t=document.createElement("script");return t.src=e,t.type="text/javascript",t.async=!0,new Promise(((i,n)=>{t.onload=()=>{Te.log(`Script loaded: ${e}`),i()},t.onerror=()=>{Te.error(`Failed to load script: ${e}`),n(new Ce(""))},document.head.appendChild(t)}))}!function(e){e.SUCCESS="1",e.ERROR="2",e.TIMEOUT="3",e.PROCESSING="4"}(Nt||(Nt={}));const Mt={doc:1,sheet:2,form:3,slide:4,pdf:7,mind:8,flowchart:9,rec:10,smartsheet:13,smartcanvas:14,resume:15,board:12};var $t;!function(e){e.appId="source3",e.isNewWebSdk="ver4",e.openType="ver5",e.loadingTime="ver7",e.loadingResult="ver6",e.hitPreheat="ver11",e.importResult="ver12",e.ext="ver10",e.size="ver9",e.title="obj2"}($t||($t={}));let Ut=class{constructor(e,t,i,n){this.ApiEvent=e,this.configService=t,this.timerService=i,this.openService=n,this.reportSDKLoaded=Promise.resolve(),this.hitPreheat=!1,this.disableReport=ge(this.configService.config.endpoint),localStorage.getItem("__WebOffice_debug_report__")&&(this.disableReport=!1),this.disableReport||(this.reportSDKLoaded=this.initSDK()),this.ApiEvent.on("AfterBootstrap",(()=>{this.timerService.mark("WebOffice/AfterBootstrap")})),this.ApiEvent.on("HitPreheat",(e=>{"1"===e.data.status&&(this.hitPreheat=!0)}))}tdwReporter(e){return f(this,void 0,void 0,(function*(){var t;this.disableReport||(yield this.reportSDKLoaded,null===(t=window.AlloyReport)||void 0===t||t.tdwSingle(Object.assign(Object.assign({},this.defaultReport),e)))}))}reportTime(){const e={async_import:this.timerService.getDuration("WebOffice/async_import-start","WebOffice/async_import-end"),query:this.timerService.getDuration("WebOffice/query-start","WebOffice/query-end"),before_open_time:this.timerService.getDuration("WebOffice/fileOpen","WebOffice/ImportFileEnd")};e.async_import>0&&(Te.log("[time]","async_import_time:",e.async_import),this.tdwReporter({action:"async_import",[$t.loadingResult]:Nt.PROCESSING,[$t.loadingTime]:e.async_import,[$t.importResult]:Nt.PROCESSING})),e.query>0&&(Te.log("[time]","query_time:",e.query),this.tdwReporter({action:"query",[$t.loadingResult]:Nt.PROCESSING,[$t.loadingTime]:e.query,[$t.importResult]:Nt.PROCESSING})),e.before_open_time>0&&(Te.log("[time]","open_time:",e.before_open_time),this.tdwReporter({action:"before_open_time",[$t.loadingResult]:Nt.PROCESSING,[$t.loadingTime]:e.before_open_time,[$t.importResult]:Nt.PROCESSING}))}reportByFileInfo(e){var t;const i=(n=e.cached,r=e.is_chunk,!0===n?"cached":!0===r?"chunk":"query");var n,r;const o={id:e.file_id,[$t.ext]:e.ext,[$t.size]:Number(null!==(t=e.size)&&void 0!==t?t:0),[$t.title]:e.title,[$t.openType]:i};this.ApiEvent.once("firstScreen",(()=>f(this,void 0,void 0,(function*(){this.timerService.mark("WebOffice/firstScreen");const e=this.timerService.getDuration("WebOffice/fileOpen","WebOffice/firstScreen"),t=this.timerService.getDuration("WebOffice/BeforeOpenIframe","WebOffice/AfterBootstrap"),i=this.hitPreheat?this.timerService.getDuration("WebOffice/OpenByPreheatedContainer","WebOffice/firstScreen"):this.timerService.getDuration("WebOffice/AfterBootstrap","WebOffice/firstScreen");Te.log("[time]","iframeLoadTime:",t),Te.log("[time]","paintingTime:",i),Te.log("[time]","FirstScreen:",e);const n=Object.assign(Object.assign({},o),{[$t.loadingResult]:Nt.SUCCESS,[$t.importResult]:Nt.SUCCESS});this.tdwReporter(Object.assign(Object.assign({},n),{action:"show",[$t.loadingTime]:e})),this.tdwReporter(Object.assign(Object.assign({},n),{action:"iframe_show",[$t.loadingTime]:t})),this.tdwReporter(Object.assign(Object.assign({},n),{action:"painting_load",[$t.loadingTime]:i})),this.ApiEvent.emit("Performance",{messageType:"Performance",data:this.timerService.getAllPerformance()})}))))}initSDK(){return f(this,void 0,void 0,(function*(){const e="https://docs.gtimg.com/alloy-report-sdk/latest/v4/alloyreport.sdk.js";document.querySelector(`script[src="${e}"]`)||(yield Wt(e))}))}get defaultReport(){return{table:"0077918",opername:"weboffice",module:"preview_page",[$t.isNewWebSdk]:1,[$t.appId]:this.configService.config.appId,file_type:Mt[this.openService.getDocType()],[$t.hitPreheat]:this.hitPreheat?1:0}}};Ut=u([K(),p(0,$(Le)),d("design:paramtypes",[Object,wt,St,Tt])],Ut);const Kt="application/vnd.openxmlformats-officedocument.wordprocessingml.document",Vt="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Ht="application/vnd.openxmlformats-officedocument.presentationml.presentation",Bt={ppt:Ht,pptx:Ht,csv:Vt,xls:Vt,xlsx:Vt,txt:Kt,doc:Kt,docx:Kt,pdf:"application/pdf",ofd:"application/ofd"};let qt=class{constructor(e,t,i,n,r){this.ApiEvent=e,this.reportService=t,this.configService=i,this.timerService=n,this.uiService=r,this.fileInfo=null}importFileById(e){return f(this,void 0,void 0,(function*(){var t;e.hideLoading||this.uiService.tipsInstance.showTip(tt("Âú®Á∫øÈ¢ÑËßàÂä†ËΩΩ‰∏≠..."));let i=null;try{const{endpoint:t}=e,i=ve(t);this.timerService.mark("WebOffice/async_import-start");const[n,r]=yield Promise.all([Ct(e),at(e)]);this.timerService.mark("WebOffice/async_import-end"),this.fileInfo=n,this.reportService.reportByFileInfo(n);const o=yield this.queryPreviewUrl(n,i);return this.formatPreviewUrl(o,e,i,r)}catch(e){throw this.fileInfo=null,i=e,this.uiService.iframeInstance.dispose(),this.uiService.tipsInstance.showTip(e),this.reportService.tdwReporter({action:"show",[$t.loadingResult]:Nt.ERROR,[$t.importResult]:e.message}),e}finally{i&&this.ApiEvent.emit("Error",{messageType:"Error",data:{isImport:!0,retcode:null!==(t=null==i?void 0:i.retcode)&&void 0!==t?t:null,reason:i&&i.message}}),this.ApiEvent.emit("ImportFileEnd",{messageType:"ImportFileEnd",data:i}),this.timerService.mark("WebOffice/ImportFileEnd"),setTimeout((()=>{this.reportService.reportTime()}),200)}}))}importFile(e,t){return f(this,void 0,void 0,(function*(){const i=yield this.uploadFile(e,t);Pe(i,"no result no cos, cos is too big");const{fileId:n,officeType:r}=i;return this.importFileById(Object.assign(Object.assign({},t),{fileId:n,officeType:r}))}))}save(){return f(this,void 0,void 0,(function*(){if(this.configService.isOpenOfficeId(this.configService.config)){const{fileToken:t,appId:i,endpoint:n,disableRequestHeader:r}=this.configService.config;Pe(ue(this.fileInfo)&&ce(this.fileInfo.file_id),"fileId not exist!"),Pe(t,"fileToken is undefined");const o=Oe(this.configService.config);return e={endpoint:ve(n),payload:{file_id:this.fileInfo.file_id},queries:r?{wo_app_id:i,wo_user_token:t}:void 0,headers:r?void 0:Object.assign(Object.assign({"X-App-Id":i,"X-Weboffice-Token":t},this.fileInfo.file_id&&{"X-Third-FileID":this.fileInfo.file_id}),o&&{"X-WebOffice-Query":o})},new jt(e).send()}var e;throw new Ce("can't save!")}))}queryPreviewUrl(e,t){return f(this,void 0,void 0,(function*(){const{file_id:i,file_url:n,is_chunk:r,cached:o,size:s}=e;if(n&&(r||o))return n;this.timerService.mark("WebOffice/query-start");const a=Math.ceil(Number(null!=s?s:0)/1024/1024),c=Math.max(60,6*a),l=yield function(e){return f(this,arguments,void 0,(function*(e,t=60){for(let i=t;i>0;i--){const t=yield Dt(e);if(!xt(t)){if(0===t.retcode&&t.result)return t.result;throw new Ce(nt[t.retcode]||t.msg,{retcode:t.retcode})}yield fe(1e3)}throw new Ce("Retry Times out")}))}({endpoint:t,payload:{file_id:i},headers:{"X-Third-FileID":i}},c);return this.timerService.mark("WebOffice/query-end"),l.file_url||""}))}formatPreviewUrl(e,t,i,n){var r;const{docsConfig:o,fileToken:s,version:a,fileId:c}=t,l=(e=>{if("slide"===me(e)&&!0===(null==o?void 0:o.isSlidesStatusPlay)){const t=e.split("?")[0].split("/").pop();return new URL(`${i}/meetingroom/slide/player?docId=${t}&role=1&sceneSource=tobplayer&toWebofficeEdit=1`)}return new URL(e,i)})(e);return n?l.searchParams.set(z,n):s&&l.searchParams.set(X,s),(null===(r=this.fileInfo)||void 0===r?void 0:r.is_chunk)&&l.searchParams.set("notAlreadyCreate","1"),a&&l.searchParams.set("inVersion","1"),c&&(this.configService.setHeaders("X-Third-FileID",c),l.searchParams.set("wo_third_fileid",c)),l.toString()}uploadFile(e,t){return f(this,void 0,void 0,(function*(){const{endpoint:i}=t,n=yield(r={endpoint:ve(i),payload:{file_name:e.name,file_size:String(e.size)}},new kt(r).send());var r;Pe(0===n.retcode,"error!");return ge(i)?this.privateUpload(e,n.result):void 0}))}privateUpload(e,t){return f(this,void 0,void 0,(function*(){Pe(t,"result is undefined!");const i=e.name.substring(e.name.lastIndexOf(".")+1);try{const{cos_put_url:n,file_id:r,cos_file_key:o}=t;Pe(n);const s=yield ot.put(n,e,{headers:{"Content-Type":Bt[i]}});if(200===s.status){const t={fileId:null!=r?r:"",officeType:i,fileKey:null!=o?o:"",fileName:e.name};return this.ApiEvent.emit("fileUpload",new Ge({messageType:"fileUpload",data:{status:"success",result:t}})),t}throw s}catch(e){throw this.ApiEvent.emit("fileUpload",new Ge({messageType:"fileUpload",data:{status:"fail",err:e}})),e}}))}};var Xt;qt=u([U(),p(0,$(Le)),d("design:paramtypes",[Object,Ut,wt,St,Rt])],qt),function(e){e.DOC="DOC",e.SHEET="SHEET",e.SLIDE="SLIDE",e.PDF="PDF"}(Xt||(Xt={}));const zt={[mt.DOC]:Xt.DOC,[mt.DOCX]:Xt.DOC,[mt.CSV]:Xt.SHEET,[mt.XLS]:Xt.SHEET,[mt.XLSX]:Xt.SHEET,[mt.PPT]:Xt.SLIDE,[mt.PPTX]:Xt.SLIDE,[mt.PDF]:Xt.PDF};let Gt=class{constructor(e,t,i,n,r,o,s,a){this.ApiEvent=e,this.configService=t,this.stateService=i,this.timerService=n,this.openService=r,this.fileFeature=o,this.rpc=s,this.uiService=a,this.isContainerReady=!1}$OnInit(){this.configService.config.enablePreheatContainer&&(this.preheatContainer(),ht(this.configService.config))}$OnOpen(){this.timerService.mark("WebOffice/fileOpen"),this.uiService.showUI();const{config:e}=this.configService;this.configService.isOpenOfficeId(e)?this.openFileId(e):this.configService.isOpenOfficeFile(e)?this.openFile(e):this.configService.isOpenTencentdoc(e)?this.openTencentdoc(e):Ae("Has no open config!")}openFileId(e){return f(this,void 0,void 0,(function*(){const t=yield this.fileFeature.importFileById(e),i=!(yield ht(e))&&(yield this.openByPreheatedContainer(t));i||(this.openService.open(t),yield this.documentLoaded()),this.uiService.tipsInstance.hideTip(),this.ApiEvent.emit("HitPreheat",{messageType:"HitPreheat",data:{status:i?"1":"0"}})}))}openFile(e){return f(this,void 0,void 0,(function*(){const{file:t}=e,i=yield this.fileFeature.importFile(t,e);this.openService.open(i),yield this.documentLoaded(),this.uiService.tipsInstance.hideTip()}))}openTencentdoc(e){return f(this,void 0,void 0,(function*(){const{fileToken:t,tencentdocUrl:i}=e,n=yield at(e),r=new URL(i);n?r.searchParams.set(z,n):t&&r.searchParams.set(X,t),this.openService.open(r.toString())}))}preheatContainer(){if(this.isContainerReady)return;const e=this.getPreheatUrl();e?(this.openService.open(e),this.isContainerReady=!0):Te.warn("PreheatService doesn't work on this OfficeType")}openByPreheatedContainer(e){return f(this,void 0,void 0,(function*(){if(!this.isContainerReady)return!1;this.timerService.mark("WebOffice/OpenByPreheatedContainer"),Pe(this.fileFeature.fileInfo);const{file_id:t,title:i}=this.fileFeature.fileInfo,{fileToken:n,appId:r}=this.configService.config,o=gt(e,this.configService.config),s=Oe(this.configService.config);Pe(t&&i);const a={url:o,docId:t,title:i,fileToken:n,appId:r};yield this.stateService.whenApplicationReady();const c=new Qe(this.stateService,this.rpc);yield c.execute({weboffice:{headers:Object.assign(Object.assign({"X-App-Id":r},n&&{"X-WebOffice-Token":n}),s&&{"X-WebOffice-Query":s})}});const[l,u]=yield de(new qe(this.rpc).execute(a));return this.isContainerReady=!1,u?(Te.error("openByPreheatedContainer failed:",u),!1):(Te.log("openByPreheatedContainer success"),!0)}))}getPreheatUrl(){const{officeType:e,endpoint:t}=this.configService.config;if(!e)return null;let i=null;switch(zt[e]){case Xt.DOC:i=new URL(`${ve(t)}/doc/empty_edit`);break;case Xt.SHEET:i=new URL(`${ve(t)}/sheet/${q}`);break;case Xt.SLIDE:i=new URL(`${ve(t)}/slide/${q}`);break;case Xt.PDF:i=new URL(`${ve(t)}/pdf/${q}`)}const{fileId:n}=this.configService.config;return i&&n&&(this.configService.setHeaders("X-Third-FileID",n),i.searchParams.set("wo_third_fileid",n)),i?i.href:null}documentLoaded(){return Promise.race([new Promise((e=>this.ApiEvent.once("AfterBootstrap",e))),new Promise((e=>this.ApiEvent.once("Error",e))),fe(2e3)])}};Gt=u([U(),p(0,$(Le)),p(6,$(ke)),d("design:paramtypes",[Object,wt,_t,St,Tt,qt,Me,Rt])],Gt);let Qt=class{constructor(e,t,i,n){this.ApiEvent=e,this.configService=t,this.timerService=i,this.openFeature=n}$OnInit(){this.ApiEvent.on("reload",(e=>{const{data:t}=e;this.configService.isOpenOfficeId(this.configService.config)&&("slidePageRedirect"===(null==t?void 0:t.event)&&this.configService.config.docsConfig&&(this.configService.config.docsConfig.isSlidesStatusPlay=!1),this.timerService.mark("WebOffice/fileOpen"),this.openFeature.openFileId(Object.assign(Object.assign({},this.configService.config),(null==t?void 0:t.version)?{version:t.version}:{})))}))}};Qt=u([U(),p(0,$(Le)),d("design:paramtypes",[Object,wt,St,Gt])],Qt);var Yt={exports:{}};window;var Jt=Yt.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isAndroid=/android|adr/i.test(navigator.userAgent),t.isIOS=/(iphone|ipad|ipod)/i.test(navigator.userAgent),t.isHarmony=/openharmony/i.test(navigator.userAgent),t.isTimOrQQFamily=/qq|(tim|mit)\//i.test(navigator.userAgent),t.isQQMiniProgram=/qq\/|tim/i.test(navigator.userAgent)&&/miniprogram|miniapp(?!enable)/i.test(navigator.userAgent),t.isVersionAboveOrEqual=function(e,t){var i,n,r;try{var o=null===(i=new RegExp("\\b"+e+"\\/((\\d+)(\\.\\d+)+)").exec(navigator.userAgent))||void 0===i?void 0:i[1];if(!o)return!1;for(var s=o.split(".").map(Number),a=t.split(".").map(Number),c=0;c<Math.max(s.length,a.length);c+=1){var l=null!==(n=s[c])&&void 0!==n?n:0,u=null!==(r=a[c])&&void 0!==r?r:0;if(l!==u)return l>u}return!0}catch(t){return console.warn("dark-mode","Âú® "+navigator.userAgent+" ‰∏≠Êü•ÊâæÂπ∂Âà§Êñ≠ "+e+" ÁöÑÁâàÊú¨Âè∑Â§±Ë¥•",t),!1}}},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=i(6),s=i(2),a=function(e){function t(){var t=e.call(this)||this;return t.type="BaseDetector",t.isSupported=t.isInitiallySupported(),t.hasDetected=!1,t.internalOnChange=function(){t.isSupported=!0,t.hasDetected=!0},t.on("change",t.internalOnChange),t}return r(t,e),t.prototype.isInitiallySupported=function(){throw Error("BaseDetector::isInitiallySupported should not be called!")},t.prototype.dispose=function(){this.isSupported=!1},Object.defineProperty(t.prototype,"topWindow",{get:function(){return s.getTopWindow()},enumerable:!0,configurable:!0}),t}(o.EventEmitter);t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.traverseAncestorWindows=function(e){var t,i=window;try{for(;i.parent!==i&&(null===(t=i.parent)||void 0===t?void 0:t.document);)e(i=i.parent)}catch(e){}},t.getTopWindow=function(){var e=window;return t.traverseAncestorWindows((function(t){return e=t})),e}},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(4),a=o(i(5)),c=o(i(7)),l=o(i(8)),u=o(i(9)),p=o(i(10)),d=o(i(11)),f=o(i(12)),h=function(e){function t(){var i,n,r=e.call(this)||this;r.detectors=[new l.default,new p.default,new u.default,new d.default,new a.default,new c.default],r.forceEmitOnFocus=!1,r.heightInViewport=0,r.heightOutOfViewport=0,r.scrollFix=f.default,r.initBodyEvent=function(){document.body.addEventListener("focusin",r.internalOnWindowFocus)},r.onChange=function(e,t,i){r.emit("detector-change",e);var n=r.detectors.find((function(e){return e.hasDetected}));n&&e!==n||(console.log("SoftKeyboard onChange:",e,{isSupported:e.isSupported,heightInViewport:t,heightOutOfViewport:i}),null!=t&&(r.heightInViewport=Math.round(t)),null!=i&&(r.heightOutOfViewport=Math.round(i)),r.emit("change",r))},r.internalOnWindowFocus=function(){!r.isSupported&&r.forceEmitOnFocus&&r.emit("change",r),setTimeout((function(){r.supportedDetectors.length&&!r.activeDetectors.length&&(r.supportedDetectors.forEach((function(e){return e.isSupported=!1})),r.emit("change",r))}),1e3)},window.__softKeyboardInstances=(null!==(i=window.__softKeyboardInstances)&&void 0!==i?i:[]).concat(r),window.__softKeyboardDisposeAllInstances=t.disposeAll;try{r.constructorStack=null===(n=Error().stack)||void 0===n?void 0:n.split(/\n\s+/).slice(1).join("\n")}catch(e){}return"loading"===document.readyState?window.addEventListener("load",r.initBodyEvent):r.initBodyEvent(),r.detectors.forEach((function(e){e.on("change",r.onChange.bind(r,e))})),window.addEventListener("beforeunload",(function(){return r.dispose()})),r}return r(t,e),t.disposeAll=function(){var e;null===(e=window.__softKeyboardInstances)||void 0===e||e.forEach((function(e){return e.dispose()}))},Object.defineProperty(t.prototype,"isSupported",{get:function(){return!!this.detectors.find((function(e){return e.isSupported}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportedDetectors",{get:function(){return this.detectors.filter((function(e){return e.isSupported}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeDetectors",{get:function(){return this.detectors.filter((function(e){return e.hasDetected}))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var e,t,i=this;this.detectors.forEach((function(e){e.dispose()})),null===(e=document.body)||void 0===e||e.removeEventListener("focusin",this.internalOnWindowFocus),window.__softKeyboardInstances=(null!==(t=window.__softKeyboardInstances)&&void 0!==t?t:[]).filter((function(e){return e!==i}))},t}(s.EventEmitter);t.SoftKeyboard=h;var v=new h;t.default=v},function(e,t,i){var n,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function p(e,t,i,n){var r,o,s,a;if(l(i),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),o=e._events),s=o[t]),void 0===s)s=o[t]=i,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=u(e))>0&&s.length>r&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=d.bind(n);return r.listener=i,n.wrapFn=r,r}function h(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):g(r,r.length)}function v(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function g(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var l=c.length,u=g(c,l);for(i=0;i<l;++i)o(u[i],this,t)}return!0},a.prototype.addListener=function(e,t){return p(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return p(this,e,t,!0)},a.prototype.once=function(e,t){return l(t),this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var i,n,r,o,s;if(l(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){s=i[o].listener,r=o;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,o=Object.keys(i);for(n=0;n<o.length;++n)"removeListener"!==(r=o[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},a.prototype.listenerCount=v,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),a=function(e){function t(){var t=e.call(this)||this;return t.type="TencentDocsAppDetector",t.isKeyboardVisible=!1,t.heightToWebViewTop=window.innerHeight,t.onKeyboardHeightChange=function(e,i,n,r){if(t.isKeyboardVisible=e,t.heightToWebViewTop=r,t.isKeyboardVisible){var o=window.innerHeight-Math.round(t.heightToWebViewTop/window.devicePixelRatio);t.emit("change",o,0)}else t.emit("change",0,0)},t.onResize=function(){if(t.isKeyboardVisible){var e=window.innerHeight-Math.round(t.heightToWebViewTop/window.devicePixelRatio);t.emit("change",e,0)}},t.isInitiallySupported()?(window.__softKeyboardDocsAppDetectorCallback=t.onKeyboardHeightChange,window.mqq.invoke("docx","setSoftKeyboardVisibilityCallback",{callback:"__softKeyboardDocsAppDetectorCallback"}),window.addEventListener("resize",t.onResize),t):t}return r(t,e),t.prototype.isInitiallySupported=function(){return s.isAndroid&&s.isVersionAboveOrEqual("TencentDocs","2.21.5")&&!s.isVersionAboveOrEqual("TencentDocs","2.22.0")&&!!window.mqq},t.prototype.dispose=function(){e.prototype.dispose.call(this),delete window.__softKeyboardDocsAppDetectorCallback},t}(o(i(1)).default);t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.listenersMap={}}return e.prototype.dispose=function(){this.listenersMap={}},e.prototype.on=function(e,t){var i;this.listenersMap[e]=(null!==(i=this.listenersMap[e])&&void 0!==i?i:[]).concat([t])},e.prototype.off=function(e,t){var i;this.listenersMap[e]=(null!==(i=this.listenersMap[e])&&void 0!==i?i:[]).filter((function(e){return e!==t}))},e.prototype.once=function(e,t){var i=this;this.on(e,(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];i.off(e,t),t.apply(void 0,n)}))},e.prototype.emit=function(e){for(var t,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];null===(t=this.listenersMap[e])||void 0===t||t.forEach((function(e){try{e.apply(void 0,i)}catch(e){console.error("Error in soft-keyboard event:",e)}}))},e}();t.EventEmitter=n},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.type="IFrameDetector",t.height=0,t.handleMessage=function(e){var i,n,r;"soft_keyboard_change"===(null===(i=e.data)||void 0===i?void 0:i.name)&&t.emit("change",null===(n=e.data)||void 0===n?void 0:n.heightInViewport,null===(r=e.data)||void 0===r?void 0:r.heightOutOfViewport)},t.topWindow.addEventListener("message",t.handleMessage),window.addEventListener("beforeunload",(function(){return t.dispose()})),t}return r(t,e),t.prototype.isInitiallySupported=function(){return window.top!==window},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.topWindow.removeEventListener("message",this.handleMessage)},t}(o(i(1)).default);t.default=s},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),a=function(e){function t(){var t=e.call(this)||this;return t.type="QBrowserDetector",t.height=0,t.onQBrowserKeyboardHeightChange=function(e){t.height=parseInt(e.height,10),t.emit("change",t.height,0)},document.addEventListener("qbrowserKeyboardHeightChange",t.onQBrowserKeyboardHeightChange),t}return r(t,e),t.prototype.isInitiallySupported=function(){return s.isIOS&&s.isTimOrQQFamily&&!s.isQQMiniProgram},t.prototype.dispose=function(){e.prototype.dispose.call(this),document.removeEventListener("qbrowserKeyboardHeightChange",this.onQBrowserKeyboardHeightChange)},t}(o(i(1)).default);t.default=a},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),a=function(e){function t(){var t=e.call(this)||this;return t.type="VirtualKeyboardDetector",t.onVirtualKeyboardChange=function(e){t.emit("change",e.target.boundingRect.height,0)},t.isInitiallySupported()?(navigator.virtualKeyboard.overlaysContent=!0,t.topWindow.navigator.virtualKeyboard.addEventListener("geometrychange",t.onVirtualKeyboardChange),t):t}return r(t,e),t.prototype.isInitiallySupported=function(){var e;return"virtualKeyboard"in this.topWindow.navigator&&"function"==typeof(null===(e=this.topWindow.navigator.virtualKeyboard)||void 0===e?void 0:e.addEventListener)&&!s.isHarmony},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.isInitiallySupported()&&this.topWindow.navigator.virtualKeyboard.removeEventListener("geometrychange",this.onVirtualKeyboardChange)},t}(o(i(1)).default);t.default=a},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),a=function(e){function t(){var t,i,n=e.call(this)||this;return n.type="VisualViewportDetector",n.innerHeight=n.topWindow.innerHeight,n.visualViewportHeight=n.innerHeight,n.previousValue=0,n.onVisualViewportChange=function(e){var t=n.topWindow;n.innerHeight=Math.round(t.innerHeight),n.visualViewportHeight=Math.round(t.visualViewport.height);var i=n.innerHeight-n.visualViewportHeight;(n.hasDetected||i>0)&&n.previousValue!==i&&(n.emit("change",i,0),n.previousValue=i)},n.isInitiallySupported()?(null===(t=n.topWindow.visualViewport)||void 0===t||t.addEventListener("resize",n.onVisualViewportChange),null===(i=n.topWindow.visualViewport)||void 0===i||i.addEventListener("scroll",n.onVisualViewportChange),n):n}return r(t,e),t.prototype.isInitiallySupported=function(){return s.isIOS&&"visualViewport"in this.topWindow},t.prototype.dispose=function(){var t,i;e.prototype.dispose.call(this),this.isInitiallySupported()&&(null===(t=this.topWindow.visualViewport)||void 0===t||t.removeEventListener("resize",this.onVisualViewportChange),null===(i=this.topWindow.visualViewport)||void 0===i||i.removeEventListener("scroll",this.onVisualViewportChange))},t}(o(i(1)).default);t.default=a},function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),a=function(e){function t(){var t=e.call(this)||this;return t.type="WindowResizeDetector",t.windowWidth=t.topWindow.innerWidth,t.windowMaxHeight=t.topWindow.innerHeight,t.previousHeight=0,t.onResize=function(){var e=t.topWindow,i=e.innerWidth,n=e.innerHeight;if(t.windowWidth!==i||n>t.windowMaxHeight)return t.windowWidth=i,t.windowMaxHeight=n,void t.updateHeight(0);var r=t.windowMaxHeight-n;t.updateHeight(r<120?0:r)},t.topWindow.addEventListener("resize",t.onResize),t}return r(t,e),t.prototype.isInitiallySupported=function(){var e;return s.isAndroid&&!(null===(e=navigator.virtualKeyboard)||void 0===e?void 0:e.overlaysContent)&&(!s.isTimOrQQFamily||/(TBS)/i.test(navigator.userAgent))},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.topWindow.removeEventListener("resize",this.onResize)},t.prototype.updateHeight=function(e){this.previousHeight!==e&&(this.previousHeight=e,this.emit("change",0,e))},t}(o(i(1)).default);t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),r=i(0),o=function(){function e(){var e=this;this.isEnabled=!1,this.fixScrollX=0,this.fixScrollY=0,this.isScrollingBack=!1,this.isIOSFocusScroll=!1,this.iOSFocusScrollTimeout=null,this.enableScrollFix=function(t,i){void 0===t&&(t=window.scrollX),void 0===i&&(i=window.scrollY),e.isEnabled&&e.disableScrollFix(),e.isEnabled=!0,e.fixScrollX=t,e.fixScrollY=i,e.styleNode=document.createElement("style"),e.styleNode.innerHTML="/* Auto-injected by @tencent/docs-soft-keyboard enableScrollFix() */ html { touch-action: none; overflow: hidden !important }",document.head.appendChild(e.styleNode),e.topWindow.addEventListener("focus",e.onWindowFocus,!0),e.topWindow.addEventListener("scroll",e.onWindowScroll,!0)},this.disableScrollFix=function(){e.isEnabled&&(e.isEnabled=!1,e.styleNode&&document.head.removeChild(e.styleNode),e.topWindow.removeEventListener("focus",e.onWindowFocus,!0),e.topWindow.removeEventListener("scroll",e.onWindowScroll,!0))},this.inverseScrollBack=function(){e.isScrollingBack=!0,e.topWindow.scrollTo(e.fixScrollX,e.fixScrollY)},this.onWindowScroll=function(){e.isScrollingBack||(e.isIOSFocusScroll?e.inverseScrollBack():e.topWindow.scrollTo(e.fixScrollX,e.fixScrollY))},this.onWindowFocus=function(){r.isIOS&&(e.iOSFocusScrollTimeout&&(clearTimeout(e.iOSFocusScrollTimeout),e.iOSFocusScrollTimeout=null),e.isIOSFocusScroll=!0,e.iOSFocusScrollTimeout=setTimeout((function(){e.isIOSFocusScroll=!1}),500))}}return Object.defineProperty(e.prototype,"topWindow",{get:function(){return n.getTopWindow()},enumerable:!0,configurable:!0}),e}();t.default=new o}]);const Zt=Symbol("__WebOfficeGetter__");let ei=class{setCommand(e){this.executeApiCommand=e}createProxy(e,t,i){if(ae(e)||"boolean"==typeof e||null===e||(e=>void 0===e)(e))return e;if(ce(e)){return["__deeper-data__","__function__","__getter__"].find((t=>e===t))?this.createSpecialProxy(e,t,i):e}if(!le(e))return e;if(this.isNotFirstLevelFromRoot(e,t,i))return this.createSpecialProxy(e,t,i);const n=Array.isArray(e)?[]:{},r=function(e,t){if(Array.isArray(e))return Object.keys(e);const i=new Set;for(let t=e;t!==Object.prototype;t=Object.getPrototypeOf(t)){if(t===Promise.prototype){Te.error("ËøîÂõûÁöÑÁªìÊûúÊàñËÄÖÂÆû‰æãÂ±ûÊÄß‰∏≠‰∏çÂèØ‰ª•ÊòØpromiseÂØπË±°! Âõ†‰∏∫promiseÂØπË±°Êó†Ê≥ïÈÄöËøápostmessage‰º†Ëæì",e);break}Object.getOwnPropertyNames(t).forEach((n=>{var r,o,s,a;(null===(r=void 0)||void 0===r||r)&&(((null===(o=Reflect.getOwnPropertyDescriptor(t,n))||void 0===o?void 0:o.get)||(null===(s=Reflect.getOwnPropertyDescriptor(t,n))||void 0===s?void 0:s.set))&&(Pe(ue(e),"obj must be object."),null!==(a=e[Zt])&&void 0!==a||(e[Zt]={}),e[Zt][n]=!0),i.add(n))}))}return i}(e);return r.forEach((r=>{n[r]=this.createProxy(e[r],t,i?`${i}.${r}`:r)})),n}createSpecialProxy(e,t,i){if("__function__"===e&&!i){const e=(...e)=>{var i;return Te.log("Command Apply",{callStack:"",method:"APPLY",applyParams:e}),null===(i=this.executeApiCommand)||void 0===i?void 0:i.execute({callStack:"",method:"APPLY",applyParams:e,callStackMapKey:t})};return e}return Pe(i,"curKey empty in createSpecialProxy!"),this.createNode(e,t,i,(n=>{le(e)&&Object.entries(null!=e?e:{}).forEach((([r,o])=>{try{if(i&&i.split(".").length>5)return;Object.defineProperty(n,r,{value:this.createProxy(o,t,i?`${i}.${r}`:r),writable:!1,enumerable:!0,configurable:!1})}catch(t){Te.error(e,r,o)}}))}))}createNode(e,t,i,n){const r=(...n)=>{var r;return"__function__"!==e&&(Te.error(`${i} is not a Function!`),Ae(`${i} is not a Function!`)),Te.log("Command Apply",{callStack:i,method:"APPLY",applyParams:n}),null===(r=this.executeApiCommand)||void 0===r?void 0:r.execute({callStack:i,method:"APPLY",applyParams:n,callStackMapKey:t})};Object.defineProperty(r,"then",{value:e=>f(this,void 0,void 0,(function*(){var n;Pe(i,"curKey empty in get!"),Te.log("Command Get: ",{callStack:i,method:"GET"});const r=yield null===(n=this.executeApiCommand)||void 0===n?void 0:n.execute({callStack:i,method:"GET",callStackMapKey:t});e(r)})),writable:!1,enumerable:!1,configurable:!1});return Object.defineProperty(r,"catch",{value:()=>{Te.log("catch, catch, catch, catch, catch")},writable:!1,enumerable:!1,configurable:!1}),n(r),new Proxy(r,{set:(e,n,r,o)=>{var s;return Te.log("Command Set: ",{callStack:i?`${i}.${String(n)}`:String(n),method:"SET",setValue:r}),null===(s=this.executeApiCommand)||void 0===s||s.execute({callStack:i?`${i}.${String(n)}`:String(n),method:"SET",setValue:r,callStackMapKey:t}),!0}})}isNotFirstLevelFromRoot(e,t,i){const n=!t,r=i&&le(e);return n&&r}};ei=u([U()],ei);class ti{constructor(e,t){this.rpc=e,this.proxyFactory=t,this.name="execute-api"}execute(e){return f(this,void 0,void 0,(function*(){const[t,i]=yield this.rpc.call(this.name,e);if(i)throw i;return this.proxyFactory.createProxy(t.value,t.callStackMapKey)}))}}class ii{constructor(){this._toDispose=new Set,this._isDisposed=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(0!==this._toDispose.size)try{!function(e){const t=[];for(const i of e)if(i)try{i.dispose()}catch(e){t.push(e)}if(1===t.length)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store")}(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Ce("Cannot register a disposable on itself!");return this._isDisposed?ii.DISABLE_DISPOSED_WARNING||Te.warn(new Ce("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}delete(e){if(e){if(e===this)throw new Ce("Cannot dispose a disposable on itself!");this._toDispose.delete(e),e.dispose()}}deleteAndLeak(e){e&&this._toDispose.has(e)&&this._toDispose.delete(e)}}ii.DISABLE_DISPOSED_WARNING=!1;class ni{constructor(){this._store=new ii}dispose(){this._store.dispose()}register(e){if(e===this)throw new Ce("Cannot register a disposable on itself!");return this._store.add(e)}}function ri(e,t=""){return{dispose:()=>{e()},disposableId:t}}const oi="get-application-api";let si=class extends ni{constructor(e,t,i){super(),this.rpc=e,this.proxyFactory=t,this.stateService=i,this.name=oi}execute(){return f(this,void 0,void 0,(function*(){const e=this.register(this.setNotReadyTimeoutLog());try{yield this.stateService.whenApplicationServerReady()}catch(n){throw new Ce(`[${oi}] ${n.message}`)}finally{e.dispose()}const t=Date.now(),[i,n]=yield this.rpc.call(this.name,null);if(n)throw n;const r=this.proxyFactory.createProxy(i);return ye("debug")&&Te.log(`[time] [${oi}]`,Date.now()-t),r}))}setNotReadyTimeoutLog(){const e=ri((()=>{})),t=(i=1)=>{const n=setTimeout((()=>{i<5&&t(i+1),Te.warn(`Application init time pass ${10*i}s!`)}),1e4);e.dispose(),e.dispose=()=>clearTimeout(n)};return t(),e}};si=u([U(),p(0,$(ke)),d("design:paramtypes",[Me,ei,_t])],si);class ai{constructor(e){this.config=e,this.name="get-cac-config-api"}run(e){var t,i,n,r;return(null==e?void 0:e.version)||null===(n=null===(i=null===(t=this.config.docsConfig)||void 0===t?void 0:t.weboffice)||void 0===i?void 0:i.headers)||void 0===n||delete n["X-Xsrf-Token"],(null==e?void 0:e.config)?e.config.reduce(((e,t)=>(t in this.config&&(e[t]=this.config[t]),e)),{}):null!==(r=this.config.docsConfig)&&void 0!==r?r:{}}}var ci,li,ui={exports:{}};ci=ui,li=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function r(e,t){if(!n[e]){n[e]={};for(var i=0;i<e.length;i++)n[e][e.charAt(i)]=i}return n[e][t]}var o={compressToBase64:function(e){if(null==e)return"";var i=o._compress(e,6,(function(e){return t.charAt(e)}));switch(i.length%4){default:case 0:return i;case 1:return i+"===";case 2:return i+"==";case 3:return i+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:o._decompress(e.length,32,(function(i){return r(t,e.charAt(i))}))},compressToUTF16:function(t){return null==t?"":o._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=o.compress(e),i=new Uint8Array(2*t.length),n=0,r=t.length;n<r;n++){var s=t.charCodeAt(n);i[2*n]=s>>>8,i[2*n+1]=s%256}return i},decompressFromUint8Array:function(t){if(null==t)return o.decompress(t);for(var i=new Array(t.length/2),n=0,r=i.length;n<r;n++)i[n]=256*t[2*n]+t[2*n+1];var s=[];return i.forEach((function(t){s.push(e(t))})),o.decompress(s.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":o._compress(e,6,(function(e){return i.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),o._decompress(e.length,32,(function(t){return r(i,e.charAt(t))})))},compress:function(t){return o._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,i){if(null==e)return"";var n,r,o,s={},a={},c="",l="",u="",p=2,d=3,f=2,h=[],v=0,g=0;for(o=0;o<e.length;o+=1)if(c=e.charAt(o),Object.prototype.hasOwnProperty.call(s,c)||(s[c]=d++,a[c]=!0),l=u+c,Object.prototype.hasOwnProperty.call(s,l))u=l;else{if(Object.prototype.hasOwnProperty.call(a,u)){if(u.charCodeAt(0)<256){for(n=0;n<f;n++)v<<=1,g==t-1?(g=0,h.push(i(v)),v=0):g++;for(r=u.charCodeAt(0),n=0;n<8;n++)v=v<<1|1&r,g==t-1?(g=0,h.push(i(v)),v=0):g++,r>>=1}else{for(r=1,n=0;n<f;n++)v=v<<1|r,g==t-1?(g=0,h.push(i(v)),v=0):g++,r=0;for(r=u.charCodeAt(0),n=0;n<16;n++)v=v<<1|1&r,g==t-1?(g=0,h.push(i(v)),v=0):g++,r>>=1}0==--p&&(p=Math.pow(2,f),f++),delete a[u]}else for(r=s[u],n=0;n<f;n++)v=v<<1|1&r,g==t-1?(g=0,h.push(i(v)),v=0):g++,r>>=1;0==--p&&(p=Math.pow(2,f),f++),s[l]=d++,u=String(c)}if(""!==u){if(Object.prototype.hasOwnProperty.call(a,u)){if(u.charCodeAt(0)<256){for(n=0;n<f;n++)v<<=1,g==t-1?(g=0,h.push(i(v)),v=0):g++;for(r=u.charCodeAt(0),n=0;n<8;n++)v=v<<1|1&r,g==t-1?(g=0,h.push(i(v)),v=0):g++,r>>=1}else{for(r=1,n=0;n<f;n++)v=v<<1|r,g==t-1?(g=0,h.push(i(v)),v=0):g++,r=0;for(r=u.charCodeAt(0),n=0;n<16;n++)v=v<<1|1&r,g==t-1?(g=0,h.push(i(v)),v=0):g++,r>>=1}0==--p&&(p=Math.pow(2,f),f++),delete a[u]}else for(r=s[u],n=0;n<f;n++)v=v<<1|1&r,g==t-1?(g=0,h.push(i(v)),v=0):g++,r>>=1;0==--p&&(p=Math.pow(2,f),f++)}for(r=2,n=0;n<f;n++)v=v<<1|1&r,g==t-1?(g=0,h.push(i(v)),v=0):g++,r>>=1;for(;;){if(v<<=1,g==t-1){h.push(i(v));break}g++}return h.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,i,n){var r,o,s,a,c,l,u,p=[],d=4,f=4,h=3,v="",g=[],y={val:n(0),position:i,index:1};for(r=0;r<3;r+=1)p[r]=r;for(s=0,c=Math.pow(2,2),l=1;l!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=i,y.val=n(y.index++)),s|=(a>0?1:0)*l,l<<=1;switch(s){case 0:for(s=0,c=Math.pow(2,8),l=1;l!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=i,y.val=n(y.index++)),s|=(a>0?1:0)*l,l<<=1;u=e(s);break;case 1:for(s=0,c=Math.pow(2,16),l=1;l!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=i,y.val=n(y.index++)),s|=(a>0?1:0)*l,l<<=1;u=e(s);break;case 2:return""}for(p[3]=u,o=u,g.push(u);;){if(y.index>t)return"";for(s=0,c=Math.pow(2,h),l=1;l!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=i,y.val=n(y.index++)),s|=(a>0?1:0)*l,l<<=1;switch(u=s){case 0:for(s=0,c=Math.pow(2,8),l=1;l!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=i,y.val=n(y.index++)),s|=(a>0?1:0)*l,l<<=1;p[f++]=e(s),u=f-1,d--;break;case 1:for(s=0,c=Math.pow(2,16),l=1;l!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=i,y.val=n(y.index++)),s|=(a>0?1:0)*l,l<<=1;p[f++]=e(s),u=f-1,d--;break;case 2:return g.join("")}if(0==d&&(d=Math.pow(2,h),h++),p[u])v=p[u];else{if(u!==f)return null;v=o+o.charAt(0)}g.push(v),p[f++]=o+v.charAt(0),o=v,0==--d&&(d=Math.pow(2,h),h++)}}};return o}(),null!=ci?ci.exports=li:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",(function(){return li}));var pi,di=ui.exports;const fi="LogCollectionEventType";null!==(pi=window.__TencentDocs_WebOffice_LogCollection__)&&void 0!==pi||(window.__TencentDocs_WebOffice_LogCollection__=new class{constructor(e){this.isInWebOfficeIframe=e,this.weblogInited=!1,this.logDataArray=[],this.isInWebOfficeIframe||this.listenIframeLog()}write(e,t){var i,n;const r=e.map((e=>le(e)?JSON.parse(we(e)):e));this.isInWebOfficeIframe?this.emitIframeLog(r,t):(this.logDataArray.push(r),null===(n=null===(i=window.log)||void 0===i?void 0:i[t])||void 0===n||n.call(i,...r))}init(e){return f(this,void 0,void 0,(function*(){var t,i,n;window.localStorage.setItem("wl-dev-console-105","hide"),(null===(t=window.log)||void 0===t?void 0:t.inited)&&(this.weblogInited=!0),this.isInWebOfficeIframe||this.weblogInited||(yield this.initSDK(),this.weblogInited=!0,yield null===(i=window.log)||void 0===i?void 0:i.init(105),e&&(null===(n=window.log)||void 0===n||n.identify(e)))}))}reportToWeblog(){return f(this,void 0,void 0,(function*(){var e;this.weblogInited||(yield this.init()),null===(e=window.log)||void 0===e||e.loadAsset("WL_REPORT_DIALOG",{exportToFile:!0})}))}generateCompressLog(){return di.compressToEncodedURIComponent(we(this.logDataArray))}copyToClipboard(){return f(this,void 0,void 0,(function*(){yield navigator.clipboard.writeText(this.generateCompressLog())}))}depressLogText(e){const t=di.decompressFromEncodedURIComponent(e);return JSON.parse(t)}listenIframeLog(){window.addEventListener("message",(e=>{const t=e.data;if(t.type===fi){const{data:e,level:i}=t.data;this.write(e,i)}}))}emitIframeLog(e,t){parent.postMessage({type:fi,data:{data:e,level:t}},"*")}initSDK(){return f(this,void 0,void 0,(function*(){const e="https://weblog.cdn-go.cn/sdk/latest/browser/logger-proxy.js";document.querySelector(`script[src="${e}"]`)||(yield Wt(e))}))}}(He()));const hi=window.__TencentDocs_WebOffice_LogCollection__;var vi;!function(e){e.RefreshWebofficeToken="RefreshWebofficeToken"}(vi||(vi={}));class gi{constructor(e){this.rpc=e,this.name="application-event-api"}execute(e){return f(this,void 0,void 0,(function*(){const[,t]=yield this.rpc.call(this.name,new Ge(e));t&&Te.error(`API[${this.name}] Error:`,t)}))}}class yi{constructor(e){this.rpc=e,this.name="get-weblog-api"}execute(){return f(this,void 0,void 0,(function*(){const[,e]=yield this.rpc.call(this.name,void 0);if(e)throw new Ce}))}}class mi{constructor(e){this.rpc=e,this.name="replace-location-api"}execute(e){return f(this,void 0,void 0,(function*(){const[t,i]=yield this.rpc.call(this.name,e);return i?(Te.error("[ReplaceLocationApiCommand] error:",i),!1):t}))}}class wi{constructor(e){this.container=e}reload(){this.container.resolve(Gt).$OnOpen()}save(){return this.container.resolve(qt).save()}getDocType(){return this.container.resolve(Tt).getDocType()}reportLogToWeblog(){const e=this.container.resolve(ke);new yi(e).execute().catch((e=>{throw Te.warn(tt("get-weblog-api‰∏çÂèØÁî®ÔºåËØ∑Á°ÆËÆ§WebOfficeÁâàÊú¨")),e}))}generateCompressLog(){hi.generateCompressLog()}copyLogToClipboard(){hi.copyToClipboard()}updateConfig(e){const t=this.container.resolve(wt);t.config=Object.assign(Object.assign({},t.config),e)}refreshToken(e){return f(this,void 0,void 0,(function*(){const t=this.container.resolve(ke),i=new Qe(this.container.resolve(_t),t).execute({weboffice:{headers:{"X-WebOffice-Token":e}}});new gi(t).execute({messageType:vi.RefreshWebofficeToken,data:{token:e}});const n=this.container.resolve(wt);n.config=Object.assign(Object.assign({},n.config),{fileToken:e});const{openUrl:r}=this.container.resolve(Tt);Pe(r,"[refreshToken] get openUrl error, null or undefined!");const o=new URL(r);if(o.searchParams.has(z)){const e=yield at(n.config);Pe(e,"[refreshToken] backend getCacheTokenKey error!"),o.searchParams.set(z,e)}else o.searchParams.has(X)&&o.searchParams.set(X,e);const s=new mi(t).execute({url:o.toString(),replace:!0});return(yield Promise.all([i,s])).every((e=>e))}))}}let _i=class extends(function(e){return class extends e{constructor(){super(...arguments),this.disposedStore=new ii}dispose(){this.disposedStore.dispose()}register(e){return this.disposedStore.add(e)}}}(wi)){constructor(e,t,i,n,r){super(i),this.ApiEvent=e,this.getApplicationCommand=t,this.configService=n,this.uiService=r,this.isDispose=!1,this.init()}ready(){return f(this,void 0,void 0,(function*(){const[e,t]=yield de(this.getApplicationCommand.execute());if(t)throw t;this.Application=e,Te.log("Client get application: ",e)}))}save(){const e=Object.create(null,{save:{get:()=>super.save}});return f(this,void 0,void 0,(function*(){var t,i;if(["doc","sheet","slide"].includes(this.getDocType())){yield this.ready();const e=this.Application,n="function"==typeof(null===(t=null==e?void 0:e.Public)||void 0===t?void 0:t.getOfflineDataCount),[r,o]=yield de(n?e.Public.getOfflineDataCount():0);let s=null;const a=rt.HAS_OFFLINE_DATA_NOT_SAVE;if(o?(null==o?void 0:o.message)&&o.message.startsWith(H)?s=tt("ÊúâÁ¶ªÁ∫øÊï∞ÊçÆÊú™Êèê‰∫§ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÁä∂ÊÄÅ."):(s=null!==(i=o&&(null==o?void 0:o.message))&&void 0!==i?i:o,Te.error("[Public.getOfflineDataCount] Error:",o)):ae(r)&&r>0?s=tt("ÊúâÁ¶ªÁ∫øÊï∞ÊçÆÊú™Êèê‰∫§ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÁä∂ÊÄÅ"):ae(r)||(s=tt("Á¶ªÁ∫ø‰øùÂ≠òÊó∂Êä•Èîô"),Te.error("[Public.getOfflineDataCount] Error: need return a number!",r)),s)return{retcode:a,msg:s,result:null}}return e.save.call(this)}))}destroy(){this.isDispose=!0,this.container.dispose()}init(){this.register(this.ApiEvent);const e=this.register(this.container.resolve(ke));e.addApi(new ze(this.ApiEvent)),e.addApi(new ai(this.configService.config));const t=this.container.resolve(ei);t.setCommand(new ti(e,t)),this.initLogCollection(),this.listenSoftKeyboard()}initLogCollection(){this.configService.config.disableLogCollection||this.register(ri(function(e,t,i,n){let r=0,o=0;const s=()=>o?Date.now()-o>=i?(r=0,void(o=0)):r<t-1?(o=Date.now(),void(r+=1)):(r=0,o=0,void n()):(o=Date.now(),void(r+=1));return e.addEventListener("click",s),e.addEventListener("touchend",s),()=>{e.removeEventListener("click",s),e.removeEventListener("touchend",s)}}(document,15,1e3,(()=>{this.copyLogToClipboard(),this.reportLogToWeblog()})))),Promise.race([fe(5e3),new Promise((e=>{this.ApiEvent.once("firstScreen",(()=>e()))})),new Promise(((e,t)=>{this.register(ri((()=>t(new Ce))))}))]).then((()=>{hi.init()})).catch((()=>{}))}listenSoftKeyboard(){if(!("ontouchstart"in window))return;const e=new Jt.SoftKeyboard;e.on("change",(()=>{var t;const i=window.innerHeight-this.uiService.iframeInstance.iframe.getBoundingClientRect().bottom;null===(t=this.uiService.iframeInstance.iframe.contentWindow)||void 0===t||t.postMessage({name:"soft_keyboard_change",heightInViewport:e.heightInViewport>0?e.heightInViewport-i:0,heightOutOfViewport:e.heightOutOfViewport},"*")}))}};_i=u([U(),p(0,$(Le)),p(2,$(M)),d("design:paramtypes",[Object,si,Object,wt,Rt])],_i);const bi=[Gt,Qt];class Si{constructor(e){this.version=$e,this.instance=this.initInstance(e)}openFileId(e){return Te.log("openFileId"),this.checkDispose(),this.validParams(e,"fileId",ce),this.setConfig(e),this.operateFeature(Be.OnOpen),this.instance}openFile(e){return Te.log("openFile"),this.checkDispose(),this.validParams(e,"file",(e=>!!e)),this.setConfig(e),this.operateFeature(Be.OnOpen),this.instance}openTencentDocUrl(e){return Te.log("openTencentDocUrl"),this.checkDispose(),this.validParams(e,"tencentdocUrl",ce),this.setConfig(e),this.operateFeature(Be.OnOpen),this.instance}initInstance(e){return e.logger&&Te.setLogger(e.logger),Te.log("web-office-sdk version:",$e),this.validParams(e,"appId",ce),this.container=this.initService(e),this.operateFeature(Be.OnInit),this.container.resolve(_i)}initService(e){const t=j.createChildContainer();t.registerInstance(yt,e);const{contentWindow:i}=t.resolve(Rt).iframeInstance.iframe;Pe(i,"ContentWindow doesn't exist!"),t.resolve(St).mark("WebOffice/initService");const n=new Me(i,{targetId:i.name,timeout:e.timeout});return t.registerInstance(ke,n),t.registerInstance(Le,xe()),t.registerInstance(M,t),t}operateFeature(e){bi.forEach((t=>{var i,n,r,o;Pe(this.container),e===Be.OnInit&&(null===(n=null===(i=this.container.resolve(t))||void 0===i?void 0:i.$OnInit)||void 0===n||n.call(i)),e===Be.OnOpen&&(null===(o=null===(r=this.container.resolve(t))||void 0===r?void 0:r.$OnOpen)||void 0===o||o.call(r))}))}setConfig(e){Pe(this.container);const t=this.container.resolve(wt);t.config=Object.assign(Object.assign({},t.config),e),e.logger&&Te.setLogger(e.logger)}validParams(e,t,i){Pe(ue(e),"config is not object!"),Pe(t in e,`key: ${t} is not exist in config.`),Pe(i(e[t]),`${t} type of value in config is not correct!`)}checkDispose(){if(this.instance.isDispose)throw new Ce("instance has been disposed!")}}Si.OfficeType=mt,Si.version=$e;export{yt as IConfig,mt as OfficeType,Si as WebOfficeSdk,hi as logCollection};
