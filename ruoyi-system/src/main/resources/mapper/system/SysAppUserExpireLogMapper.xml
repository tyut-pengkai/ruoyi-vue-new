<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.SysAppUserExpireLogMapper">

    <resultMap type="SysAppUserExpireLog" id="SysAppUserExpireLogResult">
        <result property="id" column="id"/>
        <result property="appId" column="app_id"/>
        <result property="appUserId" column="app_user_id"/>
        <result property="changeAmount" column="change_amount"/>
        <result property="changeType" column="change_type"/>
        <result property="expireTimeAfter" column="expire_time_after"/>
        <result property="expireTimeBefore" column="expire_time_before"/>
        <result property="pointAfter" column="point_after"/>
        <result property="pointBefore" column="point_before"/>
        <result property="changeDesc" column="change_desc"/>
        <result property="templateId" column="template_id"/>
        <result property="cardId" column="card_id"/>
        <result property="cardNo" column="card_no"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateTime" column="update_time"/>
        <result property="remark" column="remark"/>
        <result property="delFlag" column="del_flag"/>
        <association property="appUser" column="app_user_id" javaType="SysAppUser" resultMap="SysAppUserResult"/>
        <association property="app" column="app_id" javaType="SysApp" resultMap="SysAppResult"/>
    </resultMap>

    <resultMap type="SysAppUser" id="SysAppUserResult">
        <result property="appUserId" column="app_user_id"/>
        <result property="userId" column="user_id"/>
        <result property="expireTime" column="expire_time"/>
        <result property="point" column="point"/>
        <result property="loginCode" column="login_code"/>
        <association property="user" column="user_id" javaType="SysUser" resultMap="SysUserResult"/>
    </resultMap>

    <resultMap type="SysUser" id="SysUserResult">
        <id property="userId" column="user_id"/>
        <result property="userName" column="user_name"/>
        <result property="nickName" column="nick_name"/>
    </resultMap>

    <resultMap type="SysApp" id="SysAppResult">
        <result property="appId" column="app_id"/>
        <result property="appName" column="app_name"/>
        <result property="authType" column="auth_type"/>
        <result property="billType" column="bill_type"/>
        <result property="description" column="description"/>
        <result property="loginLimitU" column="app_login_limit_u"/>
        <result property="loginLimitM" column="app_login_limit_m"/>
    </resultMap>

    <sql id="selectSysAppUserExpireLogVo">
        select auel.id,
               auel.app_id,
               auel.app_user_id,
               auel.change_amount,
               auel.change_type,
               auel.expire_time_after,
               auel.expire_time_before,
               auel.point_after,
               auel.point_before,
               auel.change_desc,
               auel.template_id,
               auel.card_id,
               auel.card_no,
               auel.create_by,
               auel.create_time,
               auel.update_by,
               auel.update_time,
               auel.remark,
               auel.del_flag,
               au.app_user_id,
               au.user_id,
               au.expire_time,
               au.point,
               au.login_code,
               a.app_id,
               a.app_name,
               a.auth_type,
               a.bill_type,
               a.description,
               a.login_limit_u as app_login_limit_u,
               a.login_limit_m as app_login_limit_m,
               u.user_id,
               u.user_name,
               u.nick_name
        from sys_app_user_expire_log auel
                 left join sys_app_user au on auel.app_user_id = au.app_user_id
                 left join sys_user u on au.user_id = u.user_id
                 left join sys_app a on auel.app_id = a.app_id

    </sql>

    <select id="selectSysAppUserExpireLogList" parameterType="SysAppUserExpireLog"
            resultMap="SysAppUserExpireLogResult">
        <include refid="selectSysAppUserExpireLogVo"/>
        where auel.del_flag = '0'
        <if test="userName != null ">and (u.nick_name like concat('%', #{userName}, '%') or u.user_name like
            concat('%', #{userName}, '%') or au.login_code like concat('%', #{userName}, '%'))
        </if>
        <if test="appId != null ">and auel.app_id = #{appId}</if>
        <if test="appUserId != null ">and auel.app_user_id = #{appUserId}</if>
        <if test="changeAmount != null ">and auel.change_amount = #{changeAmount}</if>
        <if test="changeType != null">and auel.change_type = #{changeType}</if>
        <if test="expireTimeAfter != null ">and auel.expire_time_after = #{expireTimeAfter}</if>
        <if test="expireTimeBefore != null ">and auel.expire_time_before = #{expireTimeBefore}</if>
        <if test="pointAfter != null ">and auel.point_after = #{pointAfter}</if>
        <if test="pointBefore != null ">and auel.point_before = #{pointBefore}</if>
        <if test="changeDesc != null  and changeDesc != ''">and auel.change_desc = #{changeDesc}</if>
        <if test="templateId != null ">and auel.template_id = #{templateId}</if>
        <if test="cardId != null ">and auel.card_id = #{cardId}</if>
        <if test="cardNo != null ">and auel.card_no = #{cardNo}</if>
        <if test="remark != null and remark != ''">and auel.remark like concat('%', #{remark}, '%')</if>
        order by auel.id desc
    </select>

    <select id="selectSysAppUserExpireLogById" parameterType="Long" resultMap="SysAppUserExpireLogResult">
        <include refid="selectSysAppUserExpireLogVo"/>
        where auel.id = #{id}
    </select>

    <insert id="insertSysAppUserExpireLog" parameterType="SysAppUserExpireLog" useGeneratedKeys="true" keyProperty="id">
        insert into sys_app_user_expire_log
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="appId != null">app_id,</if>
            <if test="appUserId != null">app_user_id,</if>
            <if test="changeAmount != null">change_amount,</if>
            <if test="changeType != null">change_type,</if>
            <if test="expireTimeAfter != null">expire_time_after,</if>
            <if test="expireTimeBefore != null">expire_time_before,</if>
            <if test="pointAfter != null">point_after,</if>
            <if test="pointBefore != null">point_before,</if>
            <if test="changeDesc != null and changeDesc != ''">change_desc,</if>
            <if test="templateId != null">template_id,</if>
            <if test="cardId != null">card_id,</if>
            <if test="cardNo != null and cardNo != ''">card_no,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="remark != null">remark,</if>
            <if test="delFlag != null and delFlag != ''">del_flag,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="appId != null">#{appId},</if>
            <if test="appUserId != null">#{appUserId},</if>
            <if test="changeAmount != null">#{changeAmount},</if>
            <if test="changeType != null">#{changeType},</if>
            <if test="expireTimeAfter != null">#{expireTimeAfter},</if>
            <if test="expireTimeBefore != null">#{expireTimeBefore},</if>
            <if test="pointAfter != null">#{pointAfter},</if>
            <if test="pointBefore != null">#{pointBefore},</if>
            <if test="changeDesc != null and changeDesc != ''">#{changeDesc},</if>
            <if test="templateId != null">#{templateId},</if>
            <if test="cardId != null">#{cardId},</if>
            <if test="cardNo != null and cardNo != ''">#{cardNo},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="remark != null">#{remark},</if>
            <if test="delFlag != null and delFlag != ''">#{delFlag},</if>
        </trim>
    </insert>

    <update id="updateSysAppUserExpireLog" parameterType="SysAppUserExpireLog">
        update sys_app_user_expire_log
        <trim prefix="SET" suffixOverrides=",">
            <if test="appId != null">app_id = #{appId},</if>
            <if test="appUserId != null">app_user_id = #{appUserId},</if>
            <if test="changeAmount != null">change_amount = #{changeAmount},</if>
            <if test="changeType != null">change_type = #{changeType},</if>
            <if test="expireTimeAfter != null">expire_time_after = #{expireTimeAfter},</if>
            <if test="expireTimeBefore != null">expire_time_before = #{expireTimeBefore},</if>
            <if test="pointAfter != null">point_after = #{pointAfter},</if>
            <if test="pointBefore != null">point_before = #{pointBefore},</if>
            <if test="changeDesc != null and changeDesc != ''">change_desc = #{changeDesc},</if>
            <if test="templateId != null">template_id = #{templateId},</if>
            <if test="cardId != null">card_id = #{cardId},</if>
            <if test="cardNo != null and cardNo != ''">card_no = #{cardNo},</if>
            <if test="createBy != null">create_by = #{createBy},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="remark != null">remark = #{remark},</if>
            <if test="delFlag != null and delFlag != ''">del_flag = #{delFlag},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteSysAppUserExpireLogById" parameterType="Long">
        delete
        from sys_app_user_expire_log
        where id = #{id}
    </delete>

    <delete id="deleteSysAppUserExpireLogByIds" parameterType="String">
        delete from sys_app_user_expire_log where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <update id="cleanAppUserExpireLog">
        truncate table sys_app_user_expire_log
    </update>
</mapper>
