# 更新日志

## v1.5.2 - 2023-03-30
修复：修复卡密、单码无法批量导入的问题

## v1.5.1 - 2023-03-18  
修复：修复APK全局注入闪退的问题（感谢@手游大咖）  
修复：修复APK单例注入无法选择&lt;init&gt;、&lt;cinit&gt;等方法的问题  
修复：修复手机访问首页无法点击导航菜单的问题（感谢@冲你的风）  

## v1.5.0 - 2023-03-11  
修复：更正API文档个别API分类错误的问题  
修复：修复首页系统提示信息被遮挡的问题  
修复：软件用户在用户列表页切换用户状态不生效的问题  
新增：软件用户信息增加最后登录IP字段  
新增：批量增减已过期用户时长支持设置基准时间  
新增：新增不登录获取用户信息API接口【appUserInfo.nc】和【appUserInfo.nu】  
新增：支持批量导入/导出卡密和单码数据  
新增：新增日志自动清理，当日志文件超过1G，日志记录超过10w条将自动执行清理任务，阈值可在【系统配置】-【参数设置】中调整  
优化：扣时扣点日志列表调整为倒序显示  
优化：软件配置新增【开启前台充值】选项，用于设置是否在系统首页【充值续费】模块中显示该软件，默认为开启  
优化：APK快速接入优化  
&emsp;&emsp;- 支持单例模式接入  
&emsp;&emsp;- 支持选择弹窗或全屏模式  
&emsp;&emsp;- 支持有效期内不再弹窗  
优化：默认关闭系统账号注册功能，如需开启请在【系统配置】-【参数设置】中开启  

## v1.4.0 - 2023-01-13  
新增：用户过期时间/剩余点数变动日志  
新增：按条件批量操作单码/卡密/软件用户  
优化：数据库自动升级优化  
※※※注意：更新本版本后查看一下【验证管理】-【批量操作】中【对象】的选项是否为2个，如果不是2个则需要手动清除一下redis缓存，进入宝塔后台，选择【数据库】-【Redis】，右上角输入【sys_dict】并搜索，将搜索出的结果全选删除即可  

## v1.3.0 - 2023-01-02  
修复：修复限开顶号无效的问题（感谢@挽时 摆烂中的摆烂王）  
修复：修复多客户端同时登录可能绕过多开限制的问题（感谢@挽时 摆烂中的摆烂王）  
新增：代理系统新增软件用户管理  
新增：APK快速接入增加模板皮肤选择并增加一个黑白登录皮肤  
优化：系统中的"年"时长由360天更改为365天  
优化：去除配置文件中【文件存储路径】的配置，由系统自动获取  
优化：远程文件下载链接不再限制下载次数，可自定义设置链接有效期，默认为1小时  
优化：单码被停用/删除后，对应软件用户将被停用（旧版本已使用的单码必须在软件用户中停用才生效）  

## v1.2.0 - 2022-12-07  
新增：系统自动更新功能  
修复：修复APK快速接入如果版本更新链接为空更新崩溃的问题  
修复：软件试用功能异常的问题  
修复：修复试用次数设置为1次时无法正常试用的问题  
优化：新建软件时，绑定设置中允许扣到负数提供默认值  
优化：新建卡类时，可选择不关闭添加窗口继续添加  
优化：新增授权时显示卡类零售价格  
:::tip
注意：本版本升级需要调整一下application-config.yml文件，文件中主库数据源的url配置需要在原有配置后新增【&allowMultiQueries=true】  
如原url值为【url: jdbc:mysql://127.0.0.1:3306/hywlyz?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull
&useSSL=true&serverTimezone=GMT%2B8】  
则修改为【url: jdbc:mysql://127.0.0.1:3306/hywlyz?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull
&useSSL=true&serverTimezone=GMT%2B8&allowMultiQueries=true】  
:::

## v1.1.0 - 2022-11-19  
修复：修复卡类/单码类别下架后商城依然显示的问题（感谢@挽时、 ）  
修复：修复当设备码不存在时可能引起在线列表显示报错的问题  
修复：修复管理员账号打开代理制卡页面时提示无操作权限的问题  
修复：修复某些页面pageSize配置未生效的问题（感谢@挽时、 ）  
修复：修复软件删除后无法创建同名软件的问题  
修复：修复可以创建同版本号软件版本的问题，避免版本号重复导致的问题  
修复：修复代理端未根据所选软件显示对应卡类的问题（感谢@挽时、 ）  
修复：修复仪表盘软件数据总登录码数量[今日制码]不统计数量的问题  
修复：修复修改卡密密码为空时无法提交的问题（感谢@Jin县森）  
修复：修复商城按订单号查询订单报订单号长度有误的问题  
修复：修复在首页解绑设备时未校验密码的问题  
修复：修复删除代理时报错的问题  
新增：新增解绑设置可设定是否开启软件的解绑功能以及可解绑次数  
新增：前台页面导航栏支持自定义显示的栏目  
新增：前台页面支持自定义首页  
新增：前台页面支持关闭，如不需要可选择关闭，默认开启  
新增：软件增加购卡地址字段，可通过取软件信息API获取  
新增：可设置卡类是否支持解绑  
优化：优化充值余额显示的商品名称为[{网站简称}-余额充值]账号xx，xx元  
优化：商城下单时无需再填写查询密码  
优化：更新EXE注入方式，新增快速接入工具，注入成功率更高，更安全  
优化：新增系统日志开关，关闭后系统将不记录任何日志，默认为开  
优化：IP转换地址使用redis缓存  
优化：软件版本下载链接允许最长为5000字符  
调整：由于手机浏览器不兼容卡密下载，商城不再对手机用户显示卡密下载按钮  
调整：调整API接口【unbindDevice.ag】【unbindDevice.nu】【unbindDevice.nc】移除参数[enableNegative]，将以软件后台设置为准（已发布的软件不受影响）  
  
## v1.0.0 - 2022-10-18  
修复：修复代理生成的单码可能被系统商城售出的问题，代理制卡默认不上架（感谢@挽时、 ）  
新增：远程文件功能（文件上传API默认关闭，需在系统参数设置中开启）  
新增：商城导航新增查询卡密、充值续费、解绑设备选项  
新增：apk一键注入新增自动下载后自动启动安装（需在后台配置版本直链地址，被注入的apk拥有文件读写权限）  
新增：网站首页备案号设置  
优化：批量操作功能，增加同时操作单码与单码用户选项  
优化：软件用户查询页面可按到期时间/剩余点数和VIP状态查询用户  
优化：代理系统不再列出所有用户，避免用户数据泄露  
优化：卡密/单码增加是否代理制卡信息显示  
优化：完善代理查看卡密/单码页面信息显示  
  
## v0.0.9 - 2022-9-24  
修复：修复试用用户无法删除的问题  
修复：修复全局脚本中当多个内置变量在同一行时解析错误的问题（感谢@Jin县森）  
修复：修复根据正则表达式生成卡密/单码无效的问题（感谢@Jin县森）  
新增：在线授权功能，可支持一键在线授权或续费  
新增：服务器返回数据同时返回sign签名，双向SIGN签名安全性提升[注意：使用旧版SDK接入验证且通讯加密为明文的软件会无法正常使用]  
新增：非登录状态获取用户到期时间/剩余点数接口  
新增：批量操作功能，可批量操作卡密/单码/用户  
新增：批量生成的卡密/单码添加制卡批次号，卡密/单码列表支持使用批次号查询  
新增：以卡充卡接口，单码用户支持使用新单码进行充值，充值后用户剩余时长/点数将累加，由卡密继承来的多开/自定义参数信息将被新单码覆盖  
优化：优化【unbindDevice】解除绑定指定设备接口，当绑定关系不存在时返回-1  
优化：添加或更换授权文件后重新登录后台即可，无需再重启服务器  
优化：服务器所有接口时间格式化为"yyyy-MM-dd HH:mm:ss"标准格式  
优化：软件心跳间隔限制最低为30秒  
优化：减少冗余日志输出  
优化：单码用户不再同步单码的冻结删除状态，且每个单码只可被激活一次  
优化：试用功能增加【试用有效时间内重复登录不增加试用次数】选项，默认关闭（感谢@手游大咖）  
  
## v0.0.8 - 2022-08-27  
修复：易支付支付宝方式无法正常支付的问题（感谢@11）  
修复：修复卡密/单码面值过大会造成用户到期时间计算错误导致用户过期的问题（感谢@小客观）  
修复：修复软件用户页“所属软件”下拉列表显示不全的问题（感谢@小客观）  
修复：修复批量生成卡密时有几率显示undefined的问题（感谢@手游大咖）  
修复：修复给用户加款会导致用户角色丢失的bug（感谢@Jin县森）  
修复：修复RechargeCard API充值无密码充值卡时提示输入密码的问题（感谢@Jin县森）  
修复：修复全局脚本无法输入大于小于号的问题（感谢@小Ω猪）  
修复：修复清空软件用户登录日志报无权限的问题（感谢@小客观）  
新增：卡密支持携带自定义参数，使用卡密登录或充值后该参数将被附加到用户信息中，可通过用户信息API接口获取  
新增：卡密支持携带多开信息，使用卡密登录或充值后该用户的多开数将以卡密为准（多开数生效优先级：卡密设置>软件用户设置>软件设置）  
新增：软件用户页可实时查看各个软件用户在线用户数量和在线设备数量  
新增：全局脚本支持内置变量功能，形如${对象名.属性名}，具体使用方法请参看验证后台说明  
新增：新增获取用户绑定设备API接口  
优化：批量制卡中的卡密是否上架选项默认与卡类中的设置一致，默认制卡数量设置为1  
优化：优化跳转支付方式的用户体验  
优化：优化API文档，对每个API接口的返回值做了详细说明  
优化：充值卡/单码页面增加卡密使用日期显示（感谢@手游大咖）  
  
## v0.0.7 - 2022-08-06  
修复：修复windows服务器cmd窗口中文乱码的问题  
修复：修复软件最新版本API和软件最新强制版本API接口当版本停用时依然提示更新的问题  
修复：修复在线用户单码用户搜索不生效的问题（感谢@手游大咖）  
修复：修复仪表盘统计信息中今日激活充值卡/单码统计数据错误的问题（感谢@手游大咖）  
修复：修复仪表盘统计信息当充值卡/单码数据量过大时请求超时的问题  
修复：重复打开软件版本管理标签页不自动刷新为来源软件的问题（感谢@手游大咖）  
新增：安卓程序(apk)快速接入功能，支持自动签名，目前只支持[单码计时]模式  
新增：软件试用功能，支持按时间段或次数多种方式配置试用规则，同步增加试用登录API接口  
新增：增加代理批量制卡回显，支持复制和下载  
优化：简化安装步骤，去除logback.xml配置文件  
优化：用户账号/软件用户/用户设备/用户单码被冻结/过期后将立刻作用于API接口，用户将立刻下线（旧版本需等用户自行下线或后台踢掉）  
优化：优化客户端下线相关提示（系统强制下线/账号异地登录等）  
优化：用户/卡密登录API接口增加"autoReducePoint"参数，用于指定计点模式下是否登录成功后自动扣除用户点数（扣除1），默认值为true  
优化：手机访问商城体验优化  
  
## v0.0.6 - 2022-07-09  
修复：软件用户列表不显示单码用户的问题  
修复：新建版本是否检查MD5无默认值的问题  
修复：单码模式取用户信息报错的问题  
修复：登录失败的日志记录失败的问题  
新增：增加微信支付官方接口  
新增：易支付接口，包括支付宝、微信、QQ钱包通道  
新增：批量制卡回显，支持复制和下载  
新增：为减少不必要的日志记录，用户可配置是否记录WEBAPI调用日志：可选记录全部/不记录/只记录失败  
优化：win启动脚本设置为utf-8编码  
优化：商城卡密显示有效期文字调整，避免歧义  
优化：缓存IP与地址的映射，避免重复获取  
优化：列表内容默认显示条数支持自定义修改  
  
## v0.0.5 - 2022-07-02  
修复：修复注册账号API报错的问题  
修复：修复商城未填写联系方式和查询密码依然可以提交订单的问题  
修复：修复商城购登录码自动提卡失败的问题  
修复：修复批量生成卡密/登录码数量过多的情况下页面提示接口超时的问题  
修复：修复代理授权提示无法重复授权的问题  
修复：修复管理员批量制卡显示403无权限的问题  
修复：商城购买总价为0的商品无法通过付款的问题  
修复：快速接入后的软件无法识别中文用户名的问题  
新增：添加全局远程变量功能，同步添加远程脚本调用API接口  
新增：管理员可在首页发布用户公告和代理公告，用户公告全员可见，代理公告仅代理可见  
优化：软件用户信息API可以获取用户名、昵称、余额等账号相关信息  
优化：修改支付配置后可立即生效，不再需要重启服务  
优化：优化数据库结构，关键数据的删除改为逻辑删除避免误删  
优化：软件版本管理可设置下载直链地址  
优化：软件版本管理可设置是否校验MD5  
优化：限制子代理制卡价格不能低于父代理制卡价格，避免0元购漏洞  
优化：所有用户(包括新注册)都可看到左侧的个人中心与余额变动菜单  
优化：快速接入功能不再限制软件大小  
  
## v0.0.4 - 2022-06-23  
修复：修复仪表盘软件数据页内中英文软件名有时无法对齐的问题  
修复：修复订单ID生成算法可能报错的问题  
新增：代理系统  
	新增：代理用户管理（可无限级发展子代理，自定义子代理有效期）  
	新增：代理卡类授权（可自定义有效期，自定义代理价格）  
	新增：代理批量制卡  
	新增：代理制卡计费  
	新增：代理卡密管理  
	新增：代理单码管理  
新增：用户余额  
	新增：余额充值  
	新增：后台加减款  
	新增：余额变动日志  
	新增：我的订单  
优化：规范API接口参数，删除冗余参数，同步修改易模块及调用例程  
优化：优化列表页编号  
优化：如果网站开启https会导致系统错误获取站点域名为http，修改为优先加载网站配置中的站点地址，如果开启了https，请在网站配置中配置完整的https站点地址  
  
## v0.0.3 - 2022-05-21  
修复：修复后台启动时支付插件偶发加载失败的问题  
新增：添加后台安全入口功能，可自定义后台登录地址  
新增：添加全局远程脚本功能，可支持JavaScript/Python/PHP三种语言，同步添加远程脚本调用API接口  
优化：优化订单号生成逻辑  
优化：卡密列表/登录码列表/订单列表展示优化，单击表项可展开详情信息  
  
## v0.0.2 - 2022-05-14  
优化：降低系统内存占用  
  
## v0.0.1 - 2022-05-12  
修复：修复选择了API输出加密选项后返回客户端的枚举值不正确的问题（感谢@ゞ孤独旅程℡.）  
修复：修复无数据时sale dashboard页面超出下标的问题  
优化：购物时联系方式和查询密码改为必填项  
优化：订单记录增加字段区分自动发货还是手动发货  
  
## v0.0.0 - 2022-05-01  
系统内测版v0.0.0完成