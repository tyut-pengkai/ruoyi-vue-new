<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.mmclub.mapper.MDoctorsMapper">
    
    <resultMap type="MDoctors" id="MDoctorsResult">
        <result property="id"    column="id"    />
        <result property="hospitalId"    column="hospital_id"    />
        <result property="name"    column="name"    />
        <result property="nameCn"    column="name_cn"    />
        <result property="profilePhoto"    column="profile_photo"    />
        <result property="reviewCount"    column="review_count"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
        <result property="deleted"    column="deleted"    />
    </resultMap>

    <resultMap id="MDoctorsMDoctorSpecialtyResult" type="MDoctors" extends="MDoctorsResult">
        <collection property="mDoctorSpecialtyList" ofType="MDoctorSpecialty" column="id" select="selectMDoctorSpecialtyList" />
    </resultMap>

    <resultMap type="MDoctorSpecialty" id="MDoctorSpecialtyResult">
        <result property="id"    column="id"    />
        <result property="doctorId"    column="doctor_id"    />
        <result property="specialtyId"    column="specialty_id"    />
        <result property="proficiencyLevel"    column="proficiency_level"    />
        <result property="yearsExperience"    column="years_experience"    />
        <result property="certification"    column="certification"    />
        <result property="sortOrder"    column="sort_order"    />
        <result property="status"    column="status"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
        <result property="deleted"    column="deleted"    />
    </resultMap>

    <sql id="selectMDoctorsVo">
        select id, hospital_id, name, name_cn, profile_photo, review_count, create_time, update_time, deleted from m_doctors
    </sql>

    <select id="selectMDoctorsList" parameterType="MDoctors" resultMap="MDoctorsResult">
        <include refid="selectMDoctorsVo"/>
        <where>  
            <if test="hospitalId != null "> and hospital_id = #{hospitalId}</if>
            <if test="name != null  and name != ''"> and name like concat('%', #{name}, '%')</if>
            <if test="nameCn != null  and nameCn != ''"> and name_cn like concat('%', #{nameCn}, '%')</if>
            <if test="reviewCount != null "> and review_count &gt; #{reviewCount}</if>
        </where>
    </select>
    
    <select id="selectMDoctorsById" parameterType="Long" resultMap="MDoctorsMDoctorSpecialtyResult">
        select id, hospital_id, name, name_cn, profile_photo, review_count, create_time, update_time, deleted
        from m_doctors
        where id = #{id}
    </select>

    <select id="selectMDoctorSpecialtyList" resultMap="MDoctorSpecialtyResult">
        select id, doctor_id, specialty_id, proficiency_level, years_experience, certification, sort_order, status, create_time, update_time, deleted
        from m_doctor_specialty
        where doctor_id = #{doctor_id}
    </select>

    <insert id="insertMDoctors" parameterType="MDoctors">
        insert into m_doctors
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">id,</if>
            <if test="hospitalId != null">hospital_id,</if>
            <if test="name != null and name != ''">name,</if>
            <if test="nameCn != null and nameCn != ''">name_cn,</if>
            <if test="profilePhoto != null">profile_photo,</if>
            <if test="reviewCount != null">review_count,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="deleted != null">deleted,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">#{id},</if>
            <if test="hospitalId != null">#{hospitalId},</if>
            <if test="name != null and name != ''">#{name},</if>
            <if test="nameCn != null and nameCn != ''">#{nameCn},</if>
            <if test="profilePhoto != null">#{profilePhoto},</if>
            <if test="reviewCount != null">#{reviewCount},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="deleted != null">#{deleted},</if>
         </trim>
    </insert>

    <update id="updateMDoctors" parameterType="MDoctors">
        update m_doctors
        <trim prefix="SET" suffixOverrides=",">
            <if test="hospitalId != null">hospital_id = #{hospitalId},</if>
            <if test="name != null and name != ''">name = #{name},</if>
            <if test="nameCn != null and nameCn != ''">name_cn = #{nameCn},</if>
            <if test="profilePhoto != null">profile_photo = #{profilePhoto},</if>
            <if test="reviewCount != null">review_count = #{reviewCount},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="deleted != null">deleted = #{deleted},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteMDoctorsById" parameterType="Long">
        delete from m_doctors where id = #{id}
    </delete>

    <delete id="deleteMDoctorsByIds" parameterType="String">
        delete from m_doctors where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    
    <delete id="deleteMDoctorSpecialtyByDoctorIds" parameterType="String">
        delete from m_doctor_specialty where doctor_id in 
        <foreach item="doctorId" collection="array" open="(" separator="," close=")">
            #{doctorId}
        </foreach>
    </delete>

    <delete id="deleteMDoctorSpecialtyByDoctorId" parameterType="Long">
        delete from m_doctor_specialty where doctor_id = #{doctorId}
    </delete>

    <insert id="batchMDoctorSpecialty">
        insert into m_doctor_specialty( id, doctor_id, specialty_id, proficiency_level, years_experience, certification, sort_order, status, create_time, update_time, deleted) values
        <foreach item="item" index="index" collection="list" separator=",">
            ( #{item.id}, #{item.doctorId}, #{item.specialtyId}, #{item.proficiencyLevel}, #{item.yearsExperience}, #{item.certification}, #{item.sortOrder}, #{item.status}, #{item.createTime}, #{item.updateTime}, #{item.deleted})
        </foreach>
    </insert>
</mapper>