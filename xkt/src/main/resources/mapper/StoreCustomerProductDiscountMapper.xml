<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.xkt.mapper.StoreCustomerProductDiscountMapper">

    <select id="selectDiscPage" resultType="com.ruoyi.xkt.dto.storeCusProdDiscount.StoreCusProdDiscPageResDTO">
        SELECT DISTINCT
            scpd.id AS storeCusProdDiscId,
            sp.prod_art_num AS prodArtNum,
            scpd.store_id AS storeId,
            scpd.store_prod_id AS storeProdId,
            scpd.store_cus_id AS storeCusId,
            scpd.store_cus_name AS storeCusName,
            scpd.store_prod_color_id AS storeProdColorId,
            spc.color_name,
            spcs.price,
            scpd.discount,
            scpd.update_time
        FROM
            store_customer_product_discount scpd
                JOIN store_product sp ON scpd.store_prod_id = sp.id AND sp.del_flag = 0
                JOIN store_product_color spc ON scpd.store_prod_color_id = spc.id AND spc.del_flag = 0
                JOIN store_product_color_size spcs ON spc.store_prod_id = spcs.store_prod_id AND spcs.del_flag = 0 AND spc.store_color_id = spcs.store_color_id
        WHERE
            scpd.del_flag = 0 AND scpd.store_id = #{storeId}
            <if test="cusName != null  and cusName != ''"> AND scpd.store_cus_name like concat('%', #{cusName}, '%')</if>
            <if test="prodArtNum != null  and prodArtNum != ''"> AND sp.prod_art_num like concat('%', #{prodArtNum}, '%')</if>
        ORDER BY
            scpd.update_time DESC,
            scpd.store_prod_id,
            scpd.store_prod_color_id,
            scpd.store_cus_id
    </select>


</mapper>