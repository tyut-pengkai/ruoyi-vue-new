<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.SysUnbindLogMapper">

    <resultMap type="SysUnbindLog" id="SysUnbindLogResult">
        <result property="id"    column="id"    />
        <result property="appUserId"    column="app_user_id"    />
        <result property="appId"    column="app_id"    />
        <result property="firstLoginTime"    column="first_login_time"    />
        <result property="lastLoginTime"    column="last_login_time"    />
        <result property="loginTimes"    column="login_times"    />
        <result property="changeAmount"    column="change_amount"    />
        <result property="unbindType"    column="unbind_type"    />
        <result property="unbindDesc"    column="unbind_desc"    />
        <result property="expireTimeAfter"    column="expire_time_after"    />
        <result property="expireTimeBefore"    column="expire_time_before"    />
        <result property="pointAfter"    column="point_after"    />
        <result property="pointBefore"    column="point_before"    />
        <result property="deviceCode"    column="device_code"    />
        <result property="deviceCodeId"    column="device_code_id"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="remark"    column="remark"    />
        <result property="delFlag"    column="del_flag"    />
        <association property="appUser" column="app_user_id" javaType="SysAppUser" resultMap="SysAppUserResult"/>
        <association property="app" column="app_id" javaType="SysApp" resultMap="SysAppResult"/>
    </resultMap>

    <resultMap type="SysAppUser" id="SysAppUserResult">
        <result property="appUserId" column="app_user_id"/>
        <result property="userId" column="user_id"/>
        <result property="expireTime" column="expire_time"/>
        <result property="point" column="point"/>
        <result property="loginCode" column="login_code"/>
        <association property="user" column="user_id" javaType="SysUser" resultMap="SysUserResult"/>
    </resultMap>

    <resultMap type="SysUser" id="SysUserResult">
        <id property="userId" column="user_id"/>
        <result property="userName" column="user_name"/>
        <result property="nickName" column="nick_name"/>
    </resultMap>

    <resultMap type="SysApp" id="SysAppResult">
        <result property="appId" column="app_id"/>
        <result property="appName" column="app_name"/>
        <result property="authType" column="auth_type"/>
        <result property="billType" column="bill_type"/>
        <result property="description" column="description"/>
        <result property="loginLimitU" column="app_login_limit_u"/>
        <result property="loginLimitM" column="app_login_limit_m"/>
    </resultMap>

    <sql id="selectSysUnbindLogVo">
        select ul.id,
               ul.app_user_id,
               ul.app_id,
               ul.first_login_time,
               ul.last_login_time,
               ul.login_times,
               ul.change_amount,
               ul.unbind_type,
               ul.unbind_desc,
               ul.expire_time_after,
               ul.expire_time_before,
               ul.point_after,
               ul.point_before,
               ul.device_code,
               ul.device_code_id,
               ul.create_by,
               ul.create_time,
               ul.update_by,
               ul.update_time,
               ul.remark,
               ul.del_flag,
               au.app_user_id,
               au.user_id,
               au.expire_time,
               au.point,
               au.login_code,
               a.app_id,
               a.app_name,
               a.auth_type,
               a.bill_type,
               a.description,
               a.login_limit_u as app_login_limit_u,
               a.login_limit_m as app_login_limit_m,
               u.user_id,
               u.user_name,
               u.nick_name
        from sys_unbind_log ul
             left join sys_app_user au on ul.app_user_id = au.app_user_id
             left join sys_user u on au.user_id = u.user_id
             left join sys_app a on ul.app_id = a.app_id
    </sql>

    <select id="selectSysUnbindLogList" parameterType="SysUnbindLog" resultMap="SysUnbindLogResult">
        <include refid="selectSysUnbindLogVo"/>
        <where>
            <if test="userName != null ">and (u.nick_name like concat('%', #{userName}, '%') or u.user_name like
                concat('%', #{userName}, '%') or au.login_code like concat('%', #{userName}, '%'))
            </if>
            <if test="appUserId != null "> and ul.app_user_id = #{appUserId}</if>
            <if test="appId != null "> and ul.app_id = #{appId}</if>
            <if test="params.beginFirstLoginTime != null and params.beginFirstLoginTime != '' and params.endFirstLoginTime != null and params.endFirstLoginTime != ''"> and ul.first_login_time between #{params.beginFirstLoginTime} and #{params.endFirstLoginTime}</if>
            <if test="params.beginLastLoginTime != null and params.beginLastLoginTime != '' and params.endLastLoginTime != null and params.endLastLoginTime != ''"> and ul.last_login_time between #{params.beginLastLoginTime} and #{params.endLastLoginTime}</if>
            <if test="params.beginLoginTimes != null and params.beginLoginTimes != '' and params.endLoginTimes != null and params.endLoginTimes != ''"> and ul.login_times between #{params.beginLoginTimes} and #{params.endLoginTimes}</if>
            <if test="changeAmount != null "> and ul.change_amount = #{changeAmount}</if>
            <if test="unbindType != null "> and ul.unbind_type = #{unbindType}</if>
            <if test="unbindDesc != null  and unbindDesc != ''"> and ul.unbind_desc like concat('%', #{unbindDesc}, '%')</if>
            <if test="deviceCode != null  and deviceCode != ''"> and ul.device_code like concat('%', #{deviceCode}, '%')</if>
            <if test="remark != null  and remark != ''"> and ul.remark like concat('%', #{remark}, '%')</if>
        </where>
        order by ul.id desc
    </select>

    <select id="selectSysUnbindLogById" parameterType="Long" resultMap="SysUnbindLogResult">
        <include refid="selectSysUnbindLogVo"/>
        where ul.id = #{id}
    </select>

    <insert id="insertSysUnbindLog" parameterType="SysUnbindLog">
        insert into sys_unbind_log
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">id,</if>
            <if test="appUserId != null">app_user_id,</if>
            <if test="appId != null">app_id,</if>
            <if test="firstLoginTime != null">first_login_time,</if>
            <if test="lastLoginTime != null">last_login_time,</if>
            <if test="loginTimes != null">login_times,</if>
            <if test="changeAmount != null">change_amount,</if>
            <if test="unbindType != null ">unbind_type,</if>
            <if test="unbindDesc != null and unbindDesc != ''">unbind_desc,</if>
            <if test="expireTimeAfter != null">expire_time_after,</if>
            <if test="expireTimeBefore != null">expire_time_before,</if>
            <if test="pointAfter != null">point_after,</if>
            <if test="pointBefore != null">point_before,</if>
            <if test="deviceCode != null and deviceCode != ''">device_code,</if>
            <if test="deviceCodeId != null">device_code_id,</if>
            <if test="createBy != null">create_by,</if>
            create_time,
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="remark != null">remark,</if>
            <if test="delFlag != null and delFlag != ''">del_flag,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">#{id},</if>
            <if test="appUserId != null">#{appUserId},</if>
            <if test="appId != null">#{appId},</if>
            <if test="firstLoginTime != null">#{firstLoginTime},</if>
            <if test="lastLoginTime != null">#{lastLoginTime},</if>
            <if test="loginTimes != null">#{loginTimes},</if>
            <if test="changeAmount != null">#{changeAmount},</if>
            <if test="unbindType != null ">#{unbindType},</if>
            <if test="unbindDesc != null and unbindDesc != ''">#{unbindDesc},</if>
            <if test="expireTimeAfter != null">#{expireTimeAfter},</if>
            <if test="expireTimeBefore != null">#{expireTimeBefore},</if>
            <if test="pointAfter != null">#{pointAfter},</if>
            <if test="pointBefore != null">#{pointBefore},</if>
            <if test="deviceCode != null and deviceCode != ''">#{deviceCode},</if>
            <if test="deviceCodeId != null">#{deviceCodeId},</if>
            <if test="createBy != null">#{createBy},</if>
            sysdate(),
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="remark != null">#{remark},</if>
            <if test="delFlag != null and delFlag != ''">#{delFlag},</if>
         </trim>
    </insert>

    <update id="updateSysUnbindLog" parameterType="SysUnbindLog">
        update sys_unbind_log
        <trim prefix="SET" suffixOverrides=",">
            <if test="appUserId != null">app_user_id = #{appUserId},</if>
            <if test="appId != null">app_id = #{appId},</if>
            <if test="firstLoginTime != null">first_login_time = #{firstLoginTime},</if>
            <if test="lastLoginTime != null">last_login_time = #{lastLoginTime},</if>
            <if test="loginTimes != null">login_times = #{loginTimes},</if>
            <if test="changeAmount != null">change_amount = #{changeAmount},</if>
            <if test="unbindType != null ">unbind_type = #{unbindType},</if>
            <if test="unbindDesc != null and unbindDesc != ''">unbind_desc = #{unbindDesc},</if>
            <if test="expireTimeAfter != null">expire_time_after = #{expireTimeAfter},</if>
            <if test="expireTimeBefore != null">expire_time_before = #{expireTimeBefore},</if>
            <if test="pointAfter != null">point_after = #{pointAfter},</if>
            <if test="pointBefore != null">point_before = #{pointBefore},</if>
            <if test="deviceCode != null and deviceCode != ''">device_code = #{deviceCode},</if>
            <if test="deviceCodeId != null">device_code_id = #{deviceCodeId},</if>
            <!--<if test="createBy != null">create_by = #{createBy},</if>-->
            <!--<if test="createTime != null">create_time = #{createTime},</if>-->
            <if test="updateBy != null">update_by = #{updateBy},</if>
            update_time = sysdate(),
            <if test="remark != null">remark = #{remark},</if>
            <if test="delFlag != null and delFlag != ''">del_flag = #{delFlag},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteSysUnbindLogById" parameterType="Long">
        delete from sys_unbind_log where id = #{id}
    </delete>

    <delete id="deleteSysUnbindLogByIds" parameterType="String">
        delete from sys_unbind_log where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <update id="cleanUnbindLog">
        truncate table sys_unbind_log
    </update>
</mapper>
