# BeautyClub 宝塔部署指南

## 概述
本指南介绍如何在宝塔面板的Docker环境中部署BeautyClub项目。

## 前提条件
- 宝塔面板已安装Docker管理器
- 宝塔Docker环境中已有MySQL和Redis容器运行
- 服务器已安装Git

## 部署步骤

### 1. 获取代码
```bash
# 克隆项目到服务器
git clone https://gitee.com/why110/BeautyClub.git
cd BeautyClub
git checkout sg-dev
```

### 2. 配置数据库连接
编辑 `ruoyi-admin/src/main/resources/application-druid.yml` 文件，确保数据库连接配置正确：
```yaml
# 数据源配置
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driverClassName: com.mysql.cj.jdbc.Driver
    druid:
      # 主库数据源
      master:
        url: jdbc:mysql://你的MySQL容器IP:3306/ry-vue?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
        username: 你的数据库用户名
        password: 你的数据库密码
```

### 3. 配置Redis连接
编辑 `ruoyi-admin/src/main/resources/application.yml` 文件，确保Redis连接配置正确：
```yaml
# Redis配置
redis:
  # 地址
  host: 你的Redis容器IP
  # 端口，默认为6379
  port: 6379
  # 数据库索引
  database: 0
  # 密码
  password: 你的Redis密码
```

### 4. 完全清理（首次部署或重新部署）
```bash
# 执行完全清理脚本
chmod +x scripts/clean.sh
./scripts/clean.sh
```

### 5. 部署应用
```bash
# 执行部署脚本
chmod +x scripts/deploy.sh
./scripts/deploy.sh
```

## 部署脚本说明

### deploy.sh
- 自动清理旧的容器和镜像
- 构建新的Docker镜像
- 启动应用容器
- 检查应用健康状态

### clean.sh
- 完全清理所有Docker资源
- 包括容器、镜像、缓存、网络、卷
- 需要确认后执行

## 访问应用
部署成功后，应用将在以下地址运行：
- 本地访问：http://localhost:8080
- 外部访问：http://服务器IP:8080

## 常用命令

### 查看容器状态
```bash
docker ps
```

### 查看应用日志
```bash
docker logs beautyclub-app
```

### 停止应用
```bash
docker stop beautyclub-app
```

### 重启应用
```bash
docker restart beautyclub-app
```

### 进入容器
```bash
docker exec -it beautyclub-app sh
```

## 故障排除

### 1. 端口冲突
如果8080端口被占用，可以修改 `scripts/deploy.sh` 中的PORT变量：
```bash
PORT=8081  # 改为其他可用端口
```

### 2. 数据库连接失败
- 检查MySQL容器是否正常运行
- 确认数据库连接配置是否正确
- 检查防火墙设置

### 3. Redis连接失败
- 检查Redis容器是否正常运行
- 确认Redis连接配置是否正确
- 检查Redis密码设置

### 4. 应用启动失败
```bash
# 查看详细日志
docker logs beautyclub-app
```

## 更新部署
当代码有更新时，只需重新执行部署脚本：
```bash
./scripts/deploy.sh
```

脚本会自动清理旧版本并部署新版本。

## 注意事项
1. 确保宝塔Docker环境中的MySQL和Redis容器正常运行
2. 首次部署前建议执行完全清理脚本
3. 部署过程中请勿中断脚本执行
4. 建议定期备份数据库数据 