<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.mmclub.mapper.MHospitalsMapper">
    
    <resultMap type="MHospitals" id="MHospitalsResult">
        <result property="id"    column="id"    />
        <result property="name"    column="name"    />
        <result property="nameCn"    column="name_cn"    />
        <result property="description"    column="description"    />
        <result property="descriptionCn"    column="description_cn"    />
        <result property="image"    column="image"    />
        <result property="logoImage"    column="logo_image"    />
        <result property="address"    column="address"    />
        <result property="addressCn"    column="address_cn"    />
        <result property="doctorCount"    column="doctor_count"    />
        <result property="starAvg"    column="star_avg"    />
        <result property="reviewCount"    column="review_count"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
        <result property="deleted"    column="deleted"    />
    </resultMap>

    <resultMap id="MHospitalsMHospitalCategoryResult" type="MHospitals" extends="MHospitalsResult">
        <collection property="mHospitalCategoryList" ofType="MHospitalCategory" column="id" select="selectMHospitalCategoryList" />
    </resultMap>

    <resultMap type="MHospitalCategory" id="MHospitalCategoryResult">
        <result property="id"    column="id"    />
        <result property="hospitalId"    column="hospital_id"    />
        <result property="categoryId"    column="category_id"    />
        <result property="sortOrder"    column="sort_order"    />
        <result property="status"    column="status"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
        <result property="deleted"    column="deleted"    />
    </resultMap>

    <sql id="selectMHospitalsVo">
        select id, name, name_cn, description, description_cn, image, logo_image, address, address_cn, doctor_count, star_avg, review_count, create_time, update_time, deleted from m_hospitals
    </sql>

    <select id="selectMHospitalsList" parameterType="MHospitals" resultMap="MHospitalsResult">
        <include refid="selectMHospitalsVo"/>
        <where>  
            <if test="name != null  and name != ''"> and name like concat('%', #{name}, '%')</if>
            <if test="nameCn != null  and nameCn != ''"> and name_cn like concat('%', #{nameCn}, '%')</if>
            <if test="doctorCount != null "> and doctor_count &gt; #{doctorCount}</if>
            <if test="starAvg != null "> and star_avg &gt; #{starAvg}</if>
            <if test="reviewCount != null "> and review_count &gt; #{reviewCount}</if>
        </where>
    </select>
    
    <select id="selectMHospitalsById" parameterType="Long" resultMap="MHospitalsMHospitalCategoryResult">
        select id, name, name_cn, description, description_cn, image, logo_image, address, address_cn, doctor_count, star_avg, review_count, create_time, update_time, deleted
        from m_hospitals
        where id = #{id}
    </select>

    <select id="selectMHospitalCategoryList" resultMap="MHospitalCategoryResult">
        select id, hospital_id, category_id, sort_order, status, create_time, update_time, deleted
        from m_hospital_category
        where hospital_id = #{hospital_id}
    </select>

    <insert id="insertMHospitals" parameterType="MHospitals">
        insert into m_hospitals
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">id,</if>
            <if test="name != null and name != ''">name,</if>
            <if test="nameCn != null and nameCn != ''">name_cn,</if>
            <if test="description != null">description,</if>
            <if test="descriptionCn != null">description_cn,</if>
            <if test="image != null">image,</if>
            <if test="logoImage != null">logo_image,</if>
            <if test="address != null">address,</if>
            <if test="addressCn != null">address_cn,</if>
            <if test="doctorCount != null">doctor_count,</if>
            <if test="starAvg != null">star_avg,</if>
            <if test="reviewCount != null">review_count,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="deleted != null">deleted,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">#{id},</if>
            <if test="name != null and name != ''">#{name},</if>
            <if test="nameCn != null and nameCn != ''">#{nameCn},</if>
            <if test="description != null">#{description},</if>
            <if test="descriptionCn != null">#{descriptionCn},</if>
            <if test="image != null">#{image},</if>
            <if test="logoImage != null">#{logoImage},</if>
            <if test="address != null">#{address},</if>
            <if test="addressCn != null">#{addressCn},</if>
            <if test="doctorCount != null">#{doctorCount},</if>
            <if test="starAvg != null">#{starAvg},</if>
            <if test="reviewCount != null">#{reviewCount},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="deleted != null">#{deleted},</if>
         </trim>
    </insert>

    <update id="updateMHospitals" parameterType="MHospitals">
        update m_hospitals
        <trim prefix="SET" suffixOverrides=",">
            <if test="name != null and name != ''">name = #{name},</if>
            <if test="nameCn != null and nameCn != ''">name_cn = #{nameCn},</if>
            <if test="description != null">description = #{description},</if>
            <if test="descriptionCn != null">description_cn = #{descriptionCn},</if>
            <if test="image != null">image = #{image},</if>
            <if test="logoImage != null">logo_image = #{logoImage},</if>
            <if test="address != null">address = #{address},</if>
            <if test="addressCn != null">address_cn = #{addressCn},</if>
            <if test="doctorCount != null">doctor_count = #{doctorCount},</if>
            <if test="starAvg != null">star_avg = #{starAvg},</if>
            <if test="reviewCount != null">review_count = #{reviewCount},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="deleted != null">deleted = #{deleted},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteMHospitalsById" parameterType="Long">
        delete from m_hospitals where id = #{id}
    </delete>

    <delete id="deleteMHospitalsByIds" parameterType="String">
        delete from m_hospitals where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    
    <delete id="deleteMHospitalCategoryByHospitalIds" parameterType="String">
        delete from m_hospital_category where hospital_id in 
        <foreach item="hospitalId" collection="array" open="(" separator="," close=")">
            #{hospitalId}
        </foreach>
    </delete>

    <delete id="deleteMHospitalCategoryByHospitalId" parameterType="Long">
        delete from m_hospital_category where hospital_id = #{hospitalId}
    </delete>

    <insert id="batchMHospitalCategory">
        insert into m_hospital_category( id, hospital_id, category_id, sort_order, status, create_time, update_time, deleted) values
        <foreach item="item" index="index" collection="list" separator=",">
            ( #{item.id}, #{item.hospitalId}, #{item.categoryId}, #{item.sortOrder}, #{item.status}, #{item.createTime}, #{item.updateTime}, #{item.deleted})
        </foreach>
    </insert>
</mapper>