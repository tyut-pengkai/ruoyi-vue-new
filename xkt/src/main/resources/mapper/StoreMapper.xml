<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.xkt.mapper.StoreMapper">

    <select id="selectStorePage" resultType="com.ruoyi.xkt.dto.store.StorePageResDTO">
        SELECT
            s.id AS storeId,
            s.store_name,
            u.user_name,
            s.contact_phone,
            s.contact_back_phone,
            s.store_status,
            s.del_flag
        FROM
            store s
                LEFT JOIN sys_user u ON s.user_id = u.user_id
            <if test="storeName != null  and storeName != ''"> and s.store_name like concat('%', #{storeName}, '%')</if>
            <if test="storeStatus != null  and storeStatus != ''"> and s.store_status = #{storeStatus}</if>
    </select>

    <select id="getSimpleInfo" resultType="com.ruoyi.xkt.dto.store.StoreSimpleResDTO">
        SELECT
            s.id AS store_id,
            s.store_name,
            s.template_num,
            s.contact_phone,
            s.contact_back_phone,
            s.wechat_account,
            s.qq_account,
            s.store_address,
            sc.legal_name,
            sc.license_name,
            EXISTS ( SELECT 1 FROM user_subscriptions us LEFT JOIN store ON s.id = us.store_id AND us.del_flag = 0 AND us.user_id = #{userId}) AS focus
        FROM
            store s
                LEFT JOIN store_homepage sh ON s.id = sh.store_id
                LEFT JOIN store_certificate sc ON s.id = sc.store_id
         WHERE
            s.id = #{storeId}
    </select>




</mapper>